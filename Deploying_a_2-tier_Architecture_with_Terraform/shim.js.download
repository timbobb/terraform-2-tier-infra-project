
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d6c47ae0-82f3-59c7-887d-27eeb2a84d67")}catch(e){}}();
(function(){"use strict";var sc=Object.defineProperty;var oc=(le,me,Ne)=>me in le?sc(le,me,{enumerable:!0,configurable:!0,writable:!0,value:Ne}):le[me]=Ne;var q=(le,me,Ne)=>(oc(le,typeof me!="symbol"?me+"":me,Ne),Ne);let le;const me=new Uint8Array(16);function Ne(){if(!le&&(le=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!le))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return le(me)}const W=[];for(let e=0;e<256;++e)W.push((e+256).toString(16).slice(1));function Js(e,t=0){return W[e[t+0]]+W[e[t+1]]+W[e[t+2]]+W[e[t+3]]+"-"+W[e[t+4]]+W[e[t+5]]+"-"+W[e[t+6]]+W[e[t+7]]+"-"+W[e[t+8]]+W[e[t+9]]+"-"+W[e[t+10]]+W[e[t+11]]+W[e[t+12]]+W[e[t+13]]+W[e[t+14]]+W[e[t+15]]}const zr={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Fe(e,t,n){if(zr.randomUUID&&!t&&!e)return zr.randomUUID();e=e||{};const r=e.random||(e.rng||Ne)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Js(r)}const Qs='.ul-loading-spinner-container{font-size:1.8rem;flex-grow:1;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.ul-loading-spinner{display:inline-block;position:relative;width:6rem;height:6rem}.ul-loading-spinner div{box-sizing:border-box;display:block;position:absolute;width:80%;height:80%;margin:5px;border:5px solid #152e3e;border-radius:50%;animation:lds-ring 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:#152e3e transparent transparent transparent}.ul-loading-spinner .first{animation-delay:-.45s}.ul-loading-spinner .second{animation-delay:-.3s}.ul-loading-spinner .third{animation-delay:-.15s}@keyframes lds-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.fade-in-transition{animation:fadeIn .4s ease-in}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}#sprig-feedback-button{border-left:0;border-radius:0 8px 8px 0;display:grid;padding:8px;text-align:center;transition:all ease-in-out 1s;z-index:inherit}#sprig-feedback-button:hover{cursor:pointer}.sprig-feedback-button-label{writing-mode:vertical-lr;text-orientation:sideways}.sprig-feedback-button-right{transform:rotate(180deg)}.sprig-feedback-button-bottom{align-self:flex-end;margin-bottom:20px}.sprig-feedback-button-light{background:#efefee;color:#000;border:1px solid #e2e3e1}.sprig-feedback-button-dark{background:#000;color:#fff;border:1px solid #000000}#sprig-feedback-container{display:flex;align-items:center;position:fixed;transition:right .2s linear,left .2s linear;z-index:2147483646}.sprig-feedback-container-left{flex-flow:row-reverse}.sprig-feedback-container-center{top:50%;transform:translateY(-50%)}.sprig-feedback-container-bottom{bottom:0%;margin-bottom:15px}.sprig-feedback-loading-container{align-items:center;background-color:#fff;border:2px solid var(--feedback-border);display:flex;max-height:90vh;max-width:90vw;min-width:0px}.sprig-feedback-loading-container-left{border-left:none;border-radius:0 8px 8px 0}.sprig-feedback-loading-container-right{border-right:none;border-radius:8px 0 0 8px}#sprig-feedback-error-container{margin:auto;text-align:center;width:360px}.sprig-feedback-error-text{font-weight:400;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol}#sprig-feedback-loading-container .ul-container{position:relative;max-height:inherit}#sprig-feedback-loading-animation{position:absolute}.sprig-feedback-loading-container-previews iframe{max-height:inherit!important}',Xs="360px",Zs=500;var Le=(e=>(e.Closed="close.click",e.Complete="survey.completed",e.FeedbackClosed="feedback.closed",e.PageChange="page.change",e.API="api",e.Override="override",e))(Le||{}),R=(e=>(e.ReplayCapture="replay.capture",e.FeedbackButtonLoaded="feedback.button.loaded",e.SDKReady="sdk.ready",e.SurveyAppeared="survey.appeared",e.SurveyClosed="survey.closed",e.SurveyDimensions="survey.dimensions",e.SurveyFadingOut="survey.fadingOut",e.SurveyHeight="survey.height",e.SurveyPresented="survey.presented",e.SurveyLifeCycle="survey.lifeCycle",e.SurveyWidth="survey.width",e.SurveyWillClose="survey.willClose",e.SurveyWillPresent="survey.will.present",e.CloseSurveyOnOverlayClick="close.survey.overlayClick",e.VisitorIDUpdated="visitor.id.updated",e.QuestionAnswered="question.answered",e))(R||{});const jt={FEEDBACK_BUTTON_LOADED:"feedback.button.loaded",SDK_READY:"sdk.ready",SURVEY_APPEARED:"survey.appeared",SURVEY_CLOSED:"survey.closed",SURVEY_DIMENSIONS:"survey.dimensions",SURVEY_FADING_OUT:"survey.fadingOut",SURVEY_HEIGHT:"survey.height",SURVEY_WIDTH:"survey.width",SURVEY_PRESENTED:"survey.presented",SURVEY_LIFE_CYCLE:"survey.lifeCycle",SURVEY_WILL_CLOSE:"survey.willClose",SURVEY_WILL_PRESENT:"survey.will.present",QUESTION_ANSWERED:"question.answered",REPLAY_CAPTURE:"replay.capture",CLOSE_SURVEY_ON_OVERLAY_CLICK:"close.survey.overlayClick",VISITOR_ID_UPDATED:"visitor.id.updated",DATA:{DISMISS_REASONS:{API:"api",CLOSED:"close.click",COMPLETE:"survey.completed",PAGE_CHANGE:"page.change",OVERRIDE:"override"},SURVEY_ID:"survey.id"}},Gr=()=>{try{return window.parent.Intercom}catch{return null}},Yr=[Object.freeze(Object.defineProperty({__proto__:null,disable:()=>{const e=Gr();e&&(e.ul_wasVisible=!!document.querySelector("iframe.intercom-launcher-frame"),e.ul_wasVisible&&e("update",{hide_default_launcher:!0}))},enable:()=>{const e=Gr();e&&(e.ul_wasVisible&&e("update",{hide_default_launcher:!1}),delete e.ul_wasVisible)}},Symbol.toStringTag,{value:"Module"}))];class eo{static disable(){Yr.forEach(t=>t.disable())}static enable(){Yr.forEach(t=>t.enable())}}var to=class extends Error{constructor(e,t,n){super(`Possible EventEmitter memory leak detected. ${n} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=e,this.type=t,this.count=n,this.name="MaxListenersExceededWarning"}},Jr=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=Jr.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(e,t,n){this.emit(e,t,n)}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const n=e.indexOf(t);return n>-1&&e.splice(n,1),[]}_wrapOnceListener(e,t){const n=(...r)=>(this.removeListener(e,n),t.apply(this,r));return Object.defineProperty(n,"name",{value:t.name}),n}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const n=this._getListeners(e);return n.forEach(r=>{r.apply(this,t)}),n.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const n=this._getListeners(e).concat(t);if(this.events.set(e,n),this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;const r=new to(this,e,this.listenerCount(e));console.warn(r)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const n=this._getListeners(e);if(n.length>0){const r=[t].concat(n);this.events.set(e,r)}else this.events.set(e,n.concat(t));return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const n=this._getListeners(e);return n.length>0&&(this._removeListener(n,t),this.events.set(e,n),this._emitInternalEvent("removeListener",e,t)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}},Qr=Jr;Qr.defaultMaxListeners=10;const C=new Qr,Kt=e=>new Promise(t=>{setTimeout(()=>{t()},e)}),no=({"userleap-platform":e})=>e!=="web";class Xr{constructor(t){q(this,"storage");q(this,"tempStorage",{});q(this,"isStorageAvailable");this.storage=window[t],this.isStorageAvailable=this.checkIfStorageAvailable()}checkIfStorageAvailable(){try{const t="__storage_test__";return this.storage.setItem(t,t),this.storage.removeItem(t),!0}catch{return!1}}setItem(t,n){this.isStorageAvailable?this.storage.setItem(t,n):this.tempStorage[t]=n}getItem(t){return this.isStorageAvailable?this.storage.getItem(t):this.tempStorage[t]}removeItem(t){this.isStorageAvailable?this.storage.removeItem(t):delete this.tempStorage[t]}clear(){this.isStorageAvailable?this.storage.clear():this.tempStorage={}}}const Y=new Xr("sessionStorage"),te=new Xr("localStorage");class ro{constructor(t){q(this,"payload");q(this,"promise");q(this,"reject",()=>{});q(this,"resolve",()=>{});this.payload=t,this.promise=new Promise((n,r)=>{this.reject=r,this.resolve=n})}resolveRequest(t){this.resolve(t)}}const K={replay:null},io=e=>{K.replay=e},so=()=>{const e=[];return K.replay&&e.push("replay"),e.join(",")},oo={RATELIMIT_RESET_DEFAULT:10};let Zr=!1,ei="",$t=!1,ti=!1,qt=[];const ao=e=>e._config&&e._config.installationMethod?e._config.installationMethod:e._gtm?"web-gtm":e._segment?"web-segment":"web-snippet",Un=e=>{var t;(t=e==null?void 0:e.blockedURI)!=null&&t.includes(window.UserLeap._API_URL)&&(ti=!0,console.warn(`[Sprig] ${e.blockedURI} is blocked by Content-Security-Policy`),document.removeEventListener("securitypolicyviolation",Un))},xn=(e="")=>{Zr=!0,ei=e};function je(e={}){const t={"Content-Type":"application/json","userleap-platform":"web","x-ul-sdk-version":"2.30.3","x-ul-installation-method":ao(e),"sprig-modules":so()};if(e.envId&&(t["x-ul-environment-id"]=e.envId),e.token&&(t.Authorization="Bearer "+e.token),e.userId&&(t["x-ul-user-id"]=e.userId),e.visitorId&&(t["x-ul-visitor-id"]=e.visitorId),e.partnerAnonymousId&&(t["x-ul-anonymous-id"]=e.partnerAnonymousId),e.mobileHeadersJSON){const n=JSON.parse(e.mobileHeadersJSON);Object.assign(t,n)}return e.locale&&(t["accept-language"]=e.locale),window.previewMode&&(t["x-ul-preview-mode"]="1"),t}const ni=async({shouldDropOnRateLimit:e,...t})=>{if(e)return{status:429};{const n=new ro(t);return qt.push(n),n.promise}},Ie=async(e,t)=>{const{retries:n=0,shouldDropOnRateLimit:r=!1,shouldRetryRequest:i=!1,...s}=t,o={url:e,options:s,retries:n,shouldDropOnRateLimit:r};if($t&&!i)return ni(o);const l={ok:!1,reportError:!1};if(Zr)return console.info(`UserLeap - ${ei}`),l;try{const a=await fetch(e,s);if(a.status===429)if(!$t&&!r||i){$t=!0;const c=a.headers.has("ratelimit-reset")?Number(a.headers.get("ratelimit-reset")):oo.RATELIMIT_RESET_DEFAULT;return await Kt(c*1e3),Ie(e,{...s,shouldDropOnRateLimit:r,shouldRetryRequest:!0})}else return ni(o);if($t=!1,qt.length&&(qt.map(u=>{const c=u.payload;Ie(c.url,{...c.options,retries:c.retries,shouldDropOnRateLimit:c.shouldDropOnRateLimit}).then(p=>{u.resolveRequest(p)})}),qt=[]),a.ok){if(a.status===249)return xn(),l;const u=await a.text();try{return u&&u!=="OK"&&(a.json=JSON.parse(u)),a}catch{return{ok:!1,reportError:!1,error:new Error(`failed parsing response json for ${e} - ${u}`)}}}return a}catch(a){const u=n+1;return u>5||ti?{ok:!1,reportError:!1,error:a}:(await Kt(Math.pow(2,n)*1e3),Ie(e,{...s,retries:u}))}},Ze={Error:1,Warn:2,Info:3,Debug:4};let An=1e3,Vt=Ze.Debug,et=[];const lo=e=>{const t=Object.entries(Ze).find(n=>n[1]===e);return(t==null?void 0:t[0])??""},co=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),uo=(e,t)=>`${co(t)}:${e}`,po=()=>{et=et.filter(e=>e.level<=Vt)},ho=()=>{et.length>An&&et.shift()},Ht=(e,t)=>{e>Vt||(et.push({level:e,line:uo(t,new Date)}),ho())},ht=e=>{Ht(Ze.Debug,e)},I=e=>{Ht(Ze.Info,e)},Rn=e=>{Ht(Ze.Warn,e)},ri=e=>{Ht(Ze.Error,e)},fo=()=>et.map(e=>e.line),mo=()=>new TextEncoder().encode(fo().join(`
`)),yo=async e=>{if(!e)return;const t=mo();return Ie(e,{body:t,method:"PUT"})},go=(e,t)=>{e!==void 0&&(An=e),t!==void 0&&(Vt=t),ht(`Initializing logger with limit of ${An} lines and ${lo(Vt)} level`),po()},ii="ul-view-sdk-script",wo=["ios","android"],Ue="visitors",xe="environments";async function ce(e,t){var s,o,l;const{shouldDropOnRateLimit:n,...r}=t;r.headers=Object.assign(je(window.UserLeap),r.headers);const i=await Ie(e,{...r,shouldDropOnRateLimit:n});if(i.ok){const a=(s=i.headers)==null?void 0:s.get("Authorization"),u=a?a.split(" "):void 0,c=u&&u.length===2?u[1]:void 0,p=(o=i.headers)==null?void 0:o.get("x-ul-visitor-id");c&&p&&(p!==window.UserLeap.visitorId||window.UserLeap.token!==c)&&(ne("token",c),ne("vid",p),C.emit(R.VisitorIDUpdated,{visitorId:p}),window.UserLeap.token=c,window.UserLeap.visitorId=p)}return(l=i.json)!=null&&l.logMessage&&console.warn(`[Sprig] ${i.json.logMessage}`),i}function ne(e,t){const n=te.getItem("userleap.ids");let r={};if(n)try{r=JSON.parse(n)}catch(s){s instanceof Error&&(s.stack=n,window.UserLeap.reportError("Failed to parse local storage credentials",s)),console.warn("[Sprig] (ERR-427) Failed to lookup saved ids",s)}let i=r[window.UserLeap.envId];i?i[e]=t:i={[e]:t},r[window.UserLeap.envId]=i;try{te.setItem("userleap.ids",JSON.stringify(r))}catch(s){s instanceof Error&&console.warn(`[Sprig] (ERR-426) Unable to write to Local Storage:: ${s.message}`)}}function Cn(){return window.previewMode?"0":window.UserLeap.visitorId??""}function se(e,t,n){const r=[window.UserLeap._API_URL,"sdk",e];return t&&t.forEach(i=>{r.push(i),i===xe?r.push(window.UserLeap.envId):i===Ue&&r.push(Cn())}),n&&r.push(n),r.join("/")}const ft=async(e,t)=>{var fe,Be,pt;const{context:n,forceBrandedLogo:r,endCard:i,isFeedback:s=!1,heatmap:o,locale:l,previewMode:a,productConfig:u,questions:c,responseGroupUid:p,surveyId:d,uuid:h,vid:g,sessionReplay:m,studyType:v}=e,y=je(window.UserLeap),f=Dn(y),b=Pn(y);if(I(`Attempting to display survey: ${d}`),m)if(I("Survey has replay attached"),f)C.emit(R.ReplayCapture,{responseGroupUid:p,hasQuestions:!!(c!=null&&c.length),surveyId:d,uploadId:m.uploadId,replayType:m.replayDurationType??"before",seconds:m.replayDurationSeconds,generateVideoUploadUrlPayload:{mediaRecordingUid:Fe(),mediaType:"screen",questionId:1,responseGroupUid:p,surveyId:d,updatedAt:new Date().toISOString(),visitorId:window.UserLeap.visitorId,isReplay:!0}});else{if(!K.replay)return window.UserLeap.reportError("displayQuestions",new Error("Replay module not registered")),{success:!1,message:"Replay module not registered",surveyState:"no survey"};K.replay.scheduleOrCaptureReplay({responseGroupId:p,surveyId:d,visitorId:g,replayParams:m,completeUploadHeaders:y,apiUrl:window.UserLeap._API_URL,triggerTimestamp:Date.now(),isStandalone:c.length===0})}if(o){if(!K.replay)return window.UserLeap.reportError("displayQuestions",new Error("Replay module not registered")),{success:!1,message:"Replay module not registered",surveyState:"no survey"};const{eventId:j,replayParams:Wr,responseGroupUid:rc,surveyId:ic}=o;await K.replay.initializeReplay({viewDocument:window.document,maxReplayDurationSeconds:300,replayNonce:window.UserLeap.replayNonce,maxInflightRequests:window.UserLeap.maxInflightReplayRequests,teardownAfter:!0}),K.replay.scheduleCapture({apiUrl:window.UserLeap._API_URL,completeUploadHeaders:y,eventId:j,isHeatmap:!0,replayParams:Wr,responseGroupId:rc,surveyId:ic,triggerTimestamp:Date.now(),visitorId:g})}if(g==null||!(c!=null&&c.length))return I(`Not displaying survey: vid: ${g} / questions: ${c}`),{success:!1,message:"[Sprig] no survey found",surveyState:"no survey"};if(window.UserLeap.container){I("Already displaying a survey");const j="[Sprig] (ERR-409) Found an existing Survey container, aborting rendering of this survey";return console.warn(j),{success:!1,message:j,surveyState:"no survey"}}if(g!==window.UserLeap.visitorId&&h!==window.UserLeap.visitorId&&!window.previewMode){const j="Attempted to display survey to a different visitor";return I(j),window.UserLeap.reportError("DisplaySurvey",new Error(j)),{success:!1,message:j,surveyState:"no survey"}}I(`Showing survey: ${d}`),(fe=K.replay)==null||fe.RecordSurveyShown({id:d,userAgent:window.navigator.userAgent}),eo.disable(),C.emit(R.SurveyWillPresent,{name:R.SurveyWillPresent,"survey.id":d});let k,E=document.createElement("div"),_,w,A;const S=j=>{const{"view.version":Wr}=j;Wr!==y["x-ul-sdk-version"]&&oi(),C.removeListener("verify.view.version",S)};C.on("verify.view.version",S),window.UserLeap.useMobileStyling=b,no(y)?(k="ul-direct-embeded-frame",_=document.head,w=window,A=!1,f&&(si(s),E.id=k,window.UserLeap.container.appendChild(E),ai(),C.emit(R.SurveyLifeCycle,{state:"presented"}),C.emit(R.SurveyPresented,{name:R.SurveyPresented,"survey.id":d}))):{frameId:k,contentWinDocHead:_,contentWindow:w,hasOverlay:A,iframe:E}=ko({productConfig:u,useMobileStyling:b,surveyId:d,isFeedback:s}),window.UserLeap.frameId=k;const F=j=>{C.once(R.CloseSurveyOnOverlayClick,j)},D={apiURL:window.UserLeap._API_URL,cards:c,configureExitOnOverlayClick:F,context:n,endCard:i,envId:window.UserLeap.envId,eventEmitFn:C.emit.bind(C),fontFamily:window.UserLeap.fontFamily,fontFamilyURL:window.UserLeap.fontFamilyURL,forceBrandedLogo:r,frame:E,headers:y,locale:l,mobileSDKVersion:window.UserLeap.mobileSDKVersion,previewKey:te.getItem("sprig.previewKey"),previewMode:a,productConfig:{framePosition:u==null?void 0:u.framePosition,desktopDisplay:u==null?void 0:u.desktopDisplay,placement:u==null?void 0:u.placement},responseGroupUid:p,startingQuestionIdx:(Be=window.UserLeap.config)==null?void 0:Be.startingQuestionIdx,studyType:v,styleNonce:window.UserLeap.styleNonce,surveyId:d,tabTitle:document.title,trackPageViewUrl:t,ulEvents:jt,upchunkLibraryURL:window.UserLeap.upchunkLibraryURL,useMobileStyling:b,userId:h,viewDocument:w==null?void 0:w.document,viewWindow:w,visitorAttributes:{externalUserId:window.UserLeap.userId,email:window.UserLeap.email},...window.UserLeap._config};(pt=window.UserLeap._config)!=null&&pt.startingQuestionIdx&&(window.UserLeap._config={...window.UserLeap._config,startingQuestionIdx:null});const z=(s?window.UserLeap.feedbackCustomStyles:window.UserLeap.customStyles)??u.customStyles;D.customStyles=z,w&&(w.__cfg=D);function H(){const j=document.createElement("script");return window.UserLeap.nonce&&j.setAttribute("nonce",window.UserLeap.nonce),j.id=ii,j}const M=window.UserLeap.viewSDKURL?window.UserLeap.viewSDKURL:D.path,Se=document.getElementById(ii);Se&&Se.remove();const he=H(),G=()=>{window.UserLeap.container&&Object.assign(window.UserLeap.container.style,{display:"flex"})};if(D.installationMethod==="web-npm"||D.installationMethod==="web-npm-bundled"){const{default:j}=await import("../view/view.tsx");j.configure(D),A&&window.UserLeap.container&&G()}else M&&(he.src=M,A&&he.addEventListener("load",()=>{window.UserLeap.container&&G()}),w==null||w.addEventListener("error",j=>{j.target instanceof HTMLScriptElement&&j.target.src===M&&window.UserLeap.reportError("loadFrameScript",new Error("Frame script failed to load"))},{capture:!0,once:!0}));return _==null||_.appendChild(he),{success:!0,surveyState:"ready",surveyId:d,responseGroupUid:p}};function Pn(e){var n;if(window.UserLeap.useMobileStyling!==void 0)return window.UserLeap.useMobileStyling;const t=((n=window.UserLeap.windowDimensions)==null?void 0:n.width)??document.body.clientWidth;return Dn(e)||t>10&&t<Zs}function Dn(e){return wo.includes(e["userleap-platform"])}const On="ul-frame";window.UserLeap&&window.Sprig&&(window.Sprig._gtm?window.Sprig=window.UserLeap:window.UserLeap=window.Sprig),window.UserLeap||(window.UserLeap=window.Sprig),window.Sprig||(window.Sprig=window.UserLeap);const vo="rgba(255,255,255, 0.95)",bo="rgba(0,0,0,0.9)",Tn="0px",si=(e,t)=>{window.UserLeap.container=document.createElement("div"),window.UserLeap.container.className=`ul-container ${e&&"ul-container-feedback"}`;const n=pi();t&&n&&!window.UserLeap.useMobileStyling?n.appendChild(window.UserLeap.container):document.body.appendChild(window.UserLeap.container)},oi=(e,t)=>{var r;Lo();const n=window.UserLeap.container;if(n)try{(r=n.parentNode)==null||r.removeChild(n),window.UserLeap.container=null,ne("trackStartUrl",null),C.emit(R.SurveyLifeCycle,{state:"dismissed"}),C.emit(R.SurveyClosed,{name:R.SurveyClosed,initiator:e,studyType:t})}catch(i){console.warn(`[Sprig] (ERR-412) Error removing UserLeap container by ${e} `+n),i instanceof Error&&window.UserLeap.reportError("dismissActiveSurvey",i)}},ai=()=>{C.once(R.SurveyWillClose,({initiator:e,studyType:t})=>{C.removeAllListeners(R.CloseSurveyOnOverlayClick),oi(e,t)})},_o=(e,t)=>{const r={...{position:"fixed",overflow:"auto",top:"0px",left:"0px",display:"none",height:"100%",width:"100%",transition:"background-color 0.3s ease-out",zIndex:2147483646}},i=t?e.overlayStyleMobile:e.overlayStyle;r["background-color"]=i==="light"?vo:bo,t||(r.margin="auto"),window.UserLeap.container&&Object.assign(window.UserLeap.container.style,r)},Eo=(e,t,n,r)=>{var c,p;const i={position:"fixed",bottom:"0px",right:Tn,border:0,backgroundColor:"rgba(0,0,0,0)",zIndex:2147483646,transition:"width 0.2s ease-in-out, height 0.2s ease-in-out",maxWidth:"100%"},s=Object.assign({},t,window.UserLeap),{desktopDisplay:o}=t||{},l=o==="center-modal";l&&(s.framePosition="center");let a,u=!1;if(n)(c=window.UserLeap.windowDimensions)!=null&&c.width?i.width=`${window.UserLeap.windowDimensions.width}px`:i.width="100%",(p=window.UserLeap.windowDimensions)!=null&&p.height?i.maxHeight=`${window.UserLeap.windowDimensions.height-20}px`:window.UserLeap.maxHeight?i.maxHeight=window.UserLeap.maxHeight:i.maxHeight=`${document.body.clientHeight-20}px`,["light","dark"].includes(s.overlayStyleMobile)&&(u=!0);else{i.width=Xs,i.maxHeight=window.UserLeap.maxHeight||"66vh";const d=()=>{u=!0,a={margin:"auto",position:"static"}};if(r)l?d():a={position:"relative",height:"300px"};else switch(s.framePosition){case"bottomLeft":a={left:Tn};break;case"topLeft":a={left:Tn,top:0};break;case"topRight":a={top:0};break;case"center":d();break}}return u&&_o(s,n),Object.assign(e.style,i,a),u},ko=({productConfig:e,useMobileStyling:t,surveyId:n,isFeedback:r})=>{var d,h;const i=On,s=r&&e.desktopDisplay==="slider";si(r,s),So();const o=document.createElement("iframe");o.id=i,o.setAttribute("title","Sprig User Feedback Dialog");const l=Eo(o,e,t,r);ai();let a=!1;o.setHeight=g=>{(parseInt(o.style.height)!=g||!a)&&(a=!0,o.style.height=`${g}px`,C.emit(R.SurveyHeight,{name:R.SurveyHeight,contentFrameHeight:g}))};let u=!1;o.setWidth=g=>{(parseInt(o.style.width)!=g||!u)&&(u=!0,o.style.width=`${g}px`,C.emit(R.SurveyWidth,{name:R.SurveyWidth,contentFrameWidth:g}))},(d=window.UserLeap.container)==null||d.appendChild(o),e&&(t?e.exitOnOverlayClickMobile:e.exitOnOverlayClick)&&window.UserLeap.container&&(window.UserLeap.container.onclick=()=>{C.emit(R.CloseSurveyOnOverlayClick)}),C.emit(R.SurveyLifeCycle,{state:"presented"}),C.emit(R.SurveyPresented,{name:R.SurveyPresented,"survey.id":n});const c=(h=o.contentWindow)==null?void 0:h.document;if(c&&(c.open("text/html","replace"),c.write("<!doctype html><head></head><body></body></html>"),c.close(),!t)){const g=c.body;g.style.display="flex",g.style.alignItems="center"}const p=c==null?void 0:c.head;return{frameId:i,contentWinDocHead:p,contentWindow:o.contentWindow,hasOverlay:l,iframe:o}},li={[R.SurveyFadingOut]:()=>{window.UserLeap.container&&Object.assign(window.UserLeap.container.style,{"background-color":"rgba(0,0,0,0)"})}},So=()=>{Object.entries(li).forEach(([e,t])=>{C.on(e,t)})},Lo=()=>{Object.entries(li).forEach(([e,t])=>{C.off(e,t)})},ci=Object.freeze({contains:(e,t)=>t.includes(e),notContains:(e,t)=>!t.includes(e),exactly:(e,t)=>t===e,notExactly:(e,t)=>t!==e,startsWith:(e,t)=>t.startsWith(e),endsWith:(e,t)=>t.endsWith(e),regex:(e,t)=>new RegExp(e).test(t),legacy:(e,t)=>new RegExp(e,"i").test(t)});function Wt(e,t){const{matchType:n,pattern:r}=e,i=n?ci[n]:ci.legacy;let s=!1;try{s=i(r,t)}catch(o){const l=`[Sprig] (ERR-445) Failed to check url match with pattern ${r}`;o instanceof Error&&(console.warn(l,o),o.stack=JSON.stringify(e),window.UserLeap.reportError(l,o))}return s}const ui=e=>{const{pageUrlEvents:t}=window.UserLeap._config,n=t==null?void 0:t.find(r=>r.id===e);return n?Wt(n,window.location.href):!1},Io=1,di=e=>e instanceof HTMLElement||e instanceof SVGElement,Mn=(e,t,n)=>{const r="ul-custom-style",i=e.getElementById(r);if(i){i.textContent=t;return}const s=e.createElement("style");n&&(s.nonce=n),s.textContent=t,s.id=r,e.head.appendChild(s)},Uo=e=>{const t=e.querySelector(".ul-card__container");let n=600,r=360;if(t){n=t.scrollHeight;const i=getComputedStyle(t),s=parseFloat(i.marginTop)+parseFloat(i.marginBottom),o=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),l=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom);n+=s+o+l;const a=t.querySelector(".ul-card--matrix_grid");r=a?a.scrollWidth:t.scrollWidth;const u=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),c=parseFloat(i.marginLeft)+parseFloat(i.marginRight),p=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth);r+=c+p+u}return[n+Io,r]},pi=()=>O,tt=()=>document.getElementById("sprig-feedback-container"),Bn=()=>document.getElementById("sprig-feedback-loading-animation"),xo=()=>{if(Bn())return;const e=document.createElement("div");return e.className="ul-loading-spinner-container",e.id="sprig-feedback-loading-animation",e.role="progressbar",e.setAttribute("aria-live","polite"),e.setAttribute("aria-busy","true"),e.setAttribute("aria-label","Processing..."),e.innerHTML=`
    <div class="ul-loading-spinner">
      <div class="first"></div>
      <div class="second"></div>
      <div class="third"></div>
      <div class="fourth"></div>
    </div>
  `,e},hi=()=>!!document.getElementById(On);let fi=!1,O=null,ue=null,Nn=!1,mt=null,Ke=null;const Ao=["bottom-left","bottom-right","center-left","center-right"],Ro=e=>{if(tt()||!Ao.includes(e))return;const[t,n]=e.split("-"),r=document.createElement("div");r.id="sprig-feedback-container",r.classList.add(`sprig-feedback-container-${n}`,`sprig-feedback-container-${t}`),document.body.appendChild(r)},zt=()=>{var t;const e=window.UserLeap.container;return((t=e==null?void 0:e.parentElement)==null?void 0:t.id)==="sprig-feedback-loading-container"},mi=()=>document.getElementById("sprig-feedback-error-container"),yi=()=>{if(!O)return 0;const e=O==null?void 0:O.clientWidth,t=window.getComputedStyle(O),n=parseInt(t.borderRightWidth||"0"),r=parseInt(t.borderLeftWidth||"0");return e+n+r},Gt=e=>{const t=tt();t&&(Ke!=null&&Ke.endsWith("right")?t.style.right=`${e}px`:Ke!=null&&Ke.endsWith("left")&&(t.style.left=`${e}px`))},Fn=()=>{if(O&&(zt()||mi())){C.off(R.SurveyAppeared,yt),jn();const e=yi();return Gt(-e),!0}return!1},yt=()=>{if(!O||!ue)return;const e=Bn();e&&e.remove(),O.style.height="auto",O.style.width="auto",ue.disabled=!1,Nn=!1},jn=()=>{if(!O)return;if(!Bn()){const t=xo();t&&(O.style.height="300px",O.style.width="360px",O.appendChild(t))}},gi=()=>{!O||!ue||(Gt(0),ue.disabled=!0,Nn=!0)},Co=async e=>{const t=await ce(se("1",[Ue],"startFeedbackStudy"),{body:JSON.stringify({surveyUuid:e}),method:"POST"});return t.ok?t.json:null},wi=async(e,t,n)=>{const{buttonTheme:r,customStyles:i,eventId:s,placement:o,desktopDisplay:l,feedbackLabel:a,surveyUuid:u,surveyId:c}=e;window.UserLeap.feedbackCustomStyles=void 0;let p=tt();if(p){if(!t&&s===mt)return;p.remove(),C.off(jt.SURVEY_FADING_OUT,Fn)}if(mt=s,!document.getElementById("sprig-feedback-style")){const{head:f}=document,b=document.createElement("style");b.id="sprig-feedback-style",b.textContent=Qs,b.nonce=window.UserLeap.styleNonce,f.appendChild(b)}Mn(document,i??"",window.UserLeap.styleNonce),fi=l==="center-modal",Ke=o;const[h,g]=o.split("-");Ro(o),p=tt(),ue=document.createElement("button");const m=document.createElement("div");m.className="sprig-feedback-button-label",m.innerText=a,ue.appendChild(m),ue.id="sprig-feedback-button",ue.classList.add(`sprig-feedback-button-${g}`,`sprig-feedback-button-${h}`,`sprig-feedback-button-${r}`,"fade-in-transition"),C.on(jt.SURVEY_FADING_OUT,Fn),ue.addEventListener("click",async()=>{const f=document.getElementById("sprig-feedback-error-container");if(hi()||mi()){if(Fn()){C.emit(R.SurveyWillClose,{name:R.SurveyWillClose,initiator:Le.FeedbackClosed,studyType:"feedbackButton"});const _=tt();f&&_&&(_.remove(),mt=null,O=null)}return}const b=je(window.UserLeap);if(!Pn(b)&&!Nn&&gi(),t){O&&O.classList.add("sprig-feedback-loading-container-previews"),await ft(t),yt();return}const E=await Co(u);if(E)C.once(R.SurveyAppeared,yt),ft({...E,studyType:"feedbackButton"},n);else if(O){const _=Do();O.appendChild(_),yt(),O.style.height="300px",O.style.width="360px"}}),p==null||p.appendChild(ue),C.emit(R.FeedbackButtonLoaded,{name:R.FeedbackButtonLoaded,"survey.id":c});const{useMobileStyling:v,_config:{border:y}}=window.UserLeap;if(!fi&&!v){const f=document.createElement("div");f.id="sprig-feedback-loading-container",f.className=`sprig-feedback-loading-container sprig-feedback-loading-container-${g}`,f.style.setProperty("--feedback-border",y),O=f,jn(),p==null||p.appendChild(f);const b=yi();Gt(-b)}else Gt(0);window.UserLeap._config.isOnQuestionsTab&&t&&!zt()&&O&&(gi(),jn(),O&&O.classList.add("sprig-feedback-loading-container-previews"),ft(t),yt())},Po=()=>{if(zt())return;const e=tt();if(!e)return;ui(mt)||(e.remove(),mt=null,O=null)},Do=()=>{const e=document.createElement("div");e.id="sprig-feedback-error-container",e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40" fill="none">
  <circle cx="20" cy="20" r="14.5" stroke="#B0B5B7" stroke-width="3"/>
  <path d="M20 12L20 21.6" stroke="#B0B5B7" stroke-width="3" stroke-linecap="round"/>
  <circle cx="19.9984" cy="27.6" r="1.6" fill="#B0B5B7"/>
  </svg>`;const t=document.createElement("h3");return t.className="sprig-feedback-error-text",t.innerText="There was an error while loading the survey",e.appendChild(t),e},Oo="!launch_darkly_";class To{constructor(){q(this,"_ldData",{})}getAllLaunchDarklyVariations(){return this._ldData}setLDFlagsVariations(t){try{return!t||typeof t!="object"||Array.isArray(t)?!1:(Object.keys(this._ldData).forEach(n=>{delete this._ldData[n]}),Object.keys(t).forEach(n=>this._ldData[`${Oo}${n}`]=(t[n]??0)+1),!0)}catch(n){return n instanceof Error&&window.UserLeap.reportError("setAllLDFlagsVariations",n),console.warn("[Sprig] An issue had occured when setting LaunchDarkly flags and variations."),!1}}}const Kn=new To;Object.freeze(Kn);const Mo="!optimizely_experiments_";class Bo{constructor(){q(this,"_optimizelyData",{})}setOptimizelyExperiment(t,n=!0){if(!t||typeof t!="object")return!1;const{experiments:r}=t;try{return n&&Object.keys(this._optimizelyData).map(i=>{delete this._optimizelyData[i]}),r&&r.map(i=>{const{id:s,variation:o}=i,l=this.transformExperimentId(s);o&&typeof o=="string"&&(this._optimizelyData[l]=o)}),!0}catch(i){return i instanceof Error&&window.UserLeap.reportError("setOptimizelyExperiment",i),!1}}getAllOptimizelyExperiments(){return this._optimizelyData}getOptimizelyVariationName(t){return this._optimizelyData[this.transformExperimentId(t)]}transformExperimentId(t){return Mo+t}getAndSetWebOptimizelyExperiments(){var t;try{if(window&&window.optimizely&&typeof window.optimizely.get=="function"){const n=(t=window.optimizely.get("state"))==null?void 0:t.getExperimentStates({isActive:!0});if(n){const r=Object.keys(n).map(i=>{var s,o;return(s=n[i].variation)!=null&&s.name?{id:i,variation:(o=n[i].variation)==null?void 0:o.name}:{id:i,variation:"Original"}});return this.setOptimizelyExperiment({experiments:r},!1),!0}return!1}return!1}catch(n){return n instanceof Error&&window.UserLeap.reportError("getAndSetWebOptimizely",n),!1}}}const Yt=new Bo;Object.freeze(Yt);class No{constructor(t,n){q(this,"paused");q(this,"queue");q(this,"ul");this.ul=t,this.paused=!1,this.queue=[],this.flush(n)}flush(t){const n=t.length;if(n)for(let r=0;r<n;r++)this.push(t[r])}isPaused(){return this.paused}pause(){this.paused=!0}unpause(){this.paused=!1;const t=this.queue.slice();this.empty(),this.flush(t)}push(t){if(this.paused)this.queue.push(t);else if(t instanceof Function)t();else{const n=Array.prototype.slice.call(t,1),r=t[0],i=this.ul[r];i instanceof Function?i.apply(this.ul,n):r&&console.warn("[Sprig] (ERR-100) No valid UserLeap action called",r)}}perform(t){if(this.paused){let n=()=>{};const r=new Promise(function(i){n=function(){i(t())}});return this.queue.push(n),r}else return t()}empty(){this.queue.length=0}}let vi=!0,$n=!1;const Fo=()=>vi=!1,jo=()=>$n=!0,Ko=["sdk_event_queue_latency_seconds","sdk_replay_add_event_batch_seconds","sdk_replay_cleanup_seconds","sdk_replay_compression_seconds","sdk_replay_get_events_between_seconds","sdk_replay_snapshot_seconds"];let gt={},qn;class $o{constructor(t){q(this,"_values",[]);q(this,"_isWebMetric");this.name=t,this._isWebMetric=Ko.includes(this.name)}report(t){if(vi&&this._values.push({time:Date.now(),value:t}),$n||!this._isWebMetric)return;const n=this.findExceededThreshold(t);n&&qn&&qn(t,n)}collect(){const t=this._values;return this._values=[],t}findExceededThreshold(t){const n=gt[this.name];if(n)return n.find(r=>this.valueExceedsThreshold(t,r))}valueExceedsThreshold(t,n){return n.type==="max"?t>n.value:n.type==="min"?t<n.value:!1}}const qo=(e,t)=>{gt={},$n=!1,e==null||e.forEach(n=>{var r;n.metric in gt||(gt[n.metric]=[]),(r=gt[n.metric])==null||r.push(n)}),qn=t},wt={},Jt=e=>{const t=new $o(e);return wt[e]=t,t},bi=(e,t)=>{let n=wt[e];return n||(n=Jt(e)),n.report(t)},Vo=async e=>{const t=Object.values(wt).map(n=>({name:n.name,values:n.collect()}));if(t.some(n=>n.values.length))try{await e(JSON.stringify(t))}catch(n){Rn(`Error posting metrics: ${n}`)}},Ho=({reportingIntervalSeconds:e,postMetrics:t})=>{e?setInterval(()=>{Vo(t)},e*1e3):Fo()},Vn=(e,t)=>{const n=performance.now();document.hidden?setTimeout(()=>Vn(e,t),e):setTimeout(()=>{const r=performance.now()-n;t.report(r/1e3),setTimeout(()=>Vn(e,t),e)},0)},Wo=(e=1e3)=>{const t=Jt("sdk_event_queue_latency_seconds");Vn(e,t)},zo=({webMetricsEnabled:e,reportingIntervalSeconds:t,thresholds:n,postMetrics:r})=>{qo(n,(i,s)=>{var o,l;if((o=K.replay)!=null&&o.isReplayRecording()){const a=`Value: ${i} on ${s.metric} violated threshold of ${s.type} ${s.value}`;(l=K.replay)==null||l.disableRecording("Threshold violated",new Error(a),{reportError:!1}),jo()}}),Ho({reportingIntervalSeconds:t,postMetrics:r}),e&&Wo()},Go={test:"test"},Yo=["popState","pushState","replaceState"],vt="!email",Hn="pageUrl";function Jo(e,t){const{pageUrlEvents:n,interactiveEvents:r,dismissOnPageChange:i}=window.UserLeap._config;if(!i)return!0;const s=[];n&&n.length&&s.push(...n),r&&r.length&&s.push(...r);const o=e&&s.find(l=>l.id===e);return o?Wt(o,window.location.href):t===window.location.href}function bt(e){var l;const{pageUrlEvents:t,interactiveEvents:n,dismissOnPageChange:r,platform:i}=window.UserLeap._config;if(i&&i!=="web")return;const s=$e("trackStartUrl"),o=s?String(s):null;t&&Si(window.location.href),n&&(Ei(),Qo()),pi()&&Po(),Y.getItem("sprig.isCapturingHeatmap")&&((l=K.replay)==null||l.checkPendingHeatmapsUrl()),!zt()&&r&&o&&o!==window.location.href&&e&&Yo.includes(e.type)&&window.UserLeap("dismissActiveSurvey",Le.PageChange)}const _i={capture:!0},Qo=()=>{const t=window.UserLeap._config.interactiveEvents.filter(r=>Wt(r,window.location.href)).map(r=>{const{name:i,properties:s}=r,{selector:o,innerText:l}=s;return o?a=>{if(di(a.target))try{a.target.closest(o)&&window.UserLeap("track",i)}catch{}return!1}:a=>(di(a.target)&&a.target.innerText===l&&window.UserLeap("track",i),!1)}),n=r=>t.forEach(i=>i(r));window.UserLeap._config.interactiveEventsHandler=n,window.addEventListener("click",n,_i)},Ei=()=>{window.UserLeap._config.interactiveEventsHandler&&window.removeEventListener("click",window.UserLeap._config.interactiveEventsHandler,_i),delete window.UserLeap._config.interactiveEventsHandler};function Xo(){["hashchange","popstate"].forEach(e=>window.addEventListener(e,bt,!0))}function Zo(){["hashchange","popstate"].forEach(e=>window.removeEventListener(e,bt,!0)),window.UserLeap._config.interactiveEvents&&Ei()}function ea(e){const t=new URL(se("1",[xe],"questions"));return Object.entries(e||{}).forEach(([n,r])=>{r&&t.searchParams.append(n,String(r))}),t.toString()}function $e(e){const t=te.getItem("userleap.ids");if(t)try{const r=JSON.parse(t)[window.UserLeap.envId];return r&&r[e]||null}catch(n){n instanceof Error&&(n.stack=t,window.UserLeap.reportError("Failed to parse local storage credentials",n)),console.warn("[Sprig] (ERR-427) Failed to lookup saved ids",n)}return null}function ki(){window.previewMode||(window.UserLeap.visitorId=Fe(),I(`Generating new vid: ${window.UserLeap.visitorId}`),ne("vid",window.UserLeap.visitorId),C.emit(R.VisitorIDUpdated,{visitorId:window.UserLeap.visitorId}))}function Si(e,t,n,r){var d,h,g;if(e.endsWith("mock_snippet.html"))return;I(`Tracking page view: ${e}`);const i=window.UserLeap._config.pageUrlEvents;let s=!1;if(i&&i.length)for(let m=0;m<i.length&&(s=Wt(i[m],e),!s);m++);if(!s)return;window.UserLeap.debugMode&&console.info("[DEBUG] Sprig trackPageView",e);const o=10,l=1;let a=[];const u={viewedAt:Date.now(),location:e},c={url:e};r&&(c.trackPageView=!0);const p=te.getItem("userleap.pageviews");try{if(a=p?JSON.parse(p):[],Array.isArray(a)||(a=[]),a.length>0){const m=a[a.length-1],v=(Date.now()-m.viewedAt)/1e3;if(m.location!=e&&v>l){const y=(d=document==null?void 0:document.querySelector('meta[name="description"]'))==null?void 0:d.getAttribute("content");(h=K.replay)==null||h.RecordPageView({...y&&{description:y},url:e,referrer:document.referrer,pageTitle:document.title})}(m.location!=e&&v>l||v>o)&&(window.UserLeap._queue.push(["track",Hn,t,c,n]),a.push(u))}else window.UserLeap._queue.push(["track",Hn,t,c,n]),a.push(u),(g=K.replay)==null||g.RecordPageView({url:e});a.length>5&&a.splice(0,a.length-5),te.setItem("userleap.pageviews",JSON.stringify(a))}catch(m){m instanceof Error&&window.UserLeap.reportError("trackPageView",m,{pageViewsStorage:p}),console.warn("[Sprig] (ERR-425) Failed to update page views in local storage")}}function ta(){const e="Backbone"in window&&window.Backbone&&window.Backbone.history?window.Backbone.history:window.history;"pushState"in e&&(e.pushState=(t=>function(...r){const i=t.apply(this,r),s=new Event("pushState");return window.dispatchEvent(s),bt(s),i})(e.pushState)),"replaceState"in e&&(e.replaceState=(t=>function(...r){const i=t.apply(this,r),s=new Event("replaceState");return window.dispatchEvent(s),bt(s),i})(e.replaceState)),Xo()}async function Wn(e,t){const n=Cn();e&&!t&&(window.UserLeap._config.mode=Go.test);const r=je(window.UserLeap),i=Pn(r),s=await ce(ea({desktopDisplay:window.UserLeap._config.desktopDisplay,isMobile:i,previewLanguage:window.UserLeap._config.previewLanguage,surveyid:e==null?void 0:e.surveyId,surveytemplateid:e==null?void 0:e.surveyTemplateId,vid:n}),{shouldDropOnRateLimit:!0});if(!s.ok)return s.reportError&&s.error&&(console.warn("[Sprig] (ERR-414) Failed to request questions from the server",s.error),window.UserLeap.reportError("getQuestions",s.error)),{success:!1,surveyState:"no survey"};if(s.json.delay&&await Kt(s.json.delay),s.json.isFeedback){const{feedbackLabel:o,productConfig:l,surveyUuid:a,feedbackCustomStyles:u}=s.json,{buttonTheme:c,placement:p,desktopDisplay:d}=l,h={customStyles:u,buttonTheme:c,desktopDisplay:d,eventId:0,feedbackLabel:o,placement:p,surveyUuid:a,surveyId:e==null?void 0:e.surveyId};wi(h,s.json)}else return ft(s.json)}function na(e){let t=e.length;for(;t;){const n=Math.floor(Math.random()*t);t-=1;const r=e[t];e[t]=e[n],e[n]=r}}function ra(e){if(!e)return;window.UserLeap._config=e,e.mute&&window.UserLeap._queue.pause();const{interactiveEvents:t,pageUrlEvents:n,dismissOnPageChange:r}=e;t&&na(t),(t||n||r)&&(ta(),bt())}async function ia(e,t){var r,i;let n=!0;return t&&((r=e==null?void 0:e.json)!=null&&r.surveyId)&&(window.UserLeap.delayingSurvey=!0,n=await t(e.json.surveyId),window.UserLeap.delayingSurvey=!1,!n)?!1:((i=e==null?void 0:e.json)!=null&&i.delay&&(window.UserLeap.delayingSurvey=!0,await Kt(e.json.delay),window.UserLeap.delayingSurvey=!1),n)}const sa=function(e){if(!window.UserLeap)return;const t=async(i={})=>{var f,b,k,E,_;const{userId:s,anonymousId:o,metadata:l={},properties:a,showSurveyCallback:u}=i;let{eventName:c}=i;if(window.UserLeap.debugMode&&c!==Hn&&console.info("[DEBUG] Sprig track",i),e.mode==="test")return;const p=te.getItem("sprig.previewKey")??void 0;if(e.requireUserIdForTracking&&!window.UserLeap.userId&&!s){const w="[Sprig] - Skipping tracking without userId";return console.warn(w),{success:!1,message:w,surveyState:"no survey"}}if(!c||c.trim().length===0){c=c?String(c):"";const w="[Sprig] - Invalid event name "+c;return console.warn(w),{success:!1,message:w,surveyState:"no survey"}}const d=window.location.href;if(l.url||(l.url=d),ne("trackStartUrl",d),(b=(f=window.UserLeap)==null?void 0:f._config)!=null&&b.optimizelyEnabled){const w=je(window.UserLeap);Dn(w)||Yt.getAndSetWebOptimizelyExperiments(),l.optimizelyExperiments=Object.assign({},Yt.getAllOptimizelyExperiments())}(E=(k=window.UserLeap)==null?void 0:k._config)!=null&&E.launchDarklyEnabled&&(l.launchDarklyFlags=Kn.getAllLaunchDarklyVariations()),s&&(window.UserLeap.userId=s),o&&(window.UserLeap.partnerAnonymousId=o),a&&(l.eventProperties=a),(_=K.replay)==null||_.RecordEvent({name:c,url:l.url}),I(`Tracking event: ${c}`);const h=window.UserLeap.delayingSurvey||hi()?await ce(se("1",[Ue],"events/batch"),{body:JSON.stringify({events:[{event:c,metadata:l}],previewKey:p}),method:"POST",shouldDropOnRateLimit:!0}):await ce(se("1",[Ue],"events"),{body:JSON.stringify({event:c,metadata:l,previewKey:p}),method:"POST",shouldDropOnRateLimit:!0});if(!h.ok){const w="[Sprig] (ERR-421) Failed to track event";return h.reportError&&(console.warn(w,h.error),h.error&&window.UserLeap.reportError("track",h.error)),{success:!1,message:w,error:h.error,surveyState:"no survey"}}s&&ne("uid",s),o&&ne("aid",o);const g=h.json;g.invalidPreviewKey&&te.removeItem("sprig.previewKey");const m=l.trackPageView?l.url:void 0;return!!(g!=null&&g.feedbackButton)&&wi(g.feedbackButton,void 0,m),await ia(h,u)?Jo(g.eventId,d)?ft(g,m):{success:!1,message:"Study should not be displayed after page navigation",surveyState:"no survey"}:{success:!1,message:"[Sprig] Callback returned false, aborting rendering of survey",surveyState:"no survey"}},n=(i,s)=>{var l;const o=(l=i==null?void 0:i.querySelector(`[id="${On}"]`))==null?void 0:l.contentDocument;o&&Mn(o,s)},r={async displaySurvey(i){return console.warn("[Sprig] displaySurvey should only be used to debug your studies; not intended for production usage."),window.UserLeap("dismissActiveSurvey",Le.Override),Wn({surveyId:i},!0)},_previewSurvey(i){window.UserLeap("dismissActiveSurvey",Le.Override),Wn({surveyTemplateId:i},!1)},_reviewSurvey(i){window.UserLeap("dismissActiveSurvey",Le.Override),Wn({surveyId:i},!1)},previewSurvey(i){r._previewSurvey(i)},reviewSurvey(i){r._reviewSurvey(i)},mute(){window.UserLeap._queue.pause()},unmute(){window.UserLeap._queue.unpause()},setVisitorToken(){console.warn("[Sprig] setVisitorToken is deprecated.")},dismissActiveSurvey(i=Le.API){C.emit(R.SurveyWillClose,{name:R.SurveyWillClose,initiator:i})},async setAttribute(i,s){if(!i||!s&&s!==0&&s!==!1){const o="[Sprig] - Disregarding empty attribute / value provided";return console.warn(o),{success:!1,message:o}}return this.setAttributes({[i]:s})},async setAttributes(i){if(i==null||Object.keys(i).length===0){const s="[Sprig] - Disregarding empty attributes provided";return console.warn(s),{success:!1,message:s}}return this.identifyAndSetAttributes({attributes:i})},async identifyAndSetAttributes(i){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig identifyAndSetAttributes",i),e.mode==="test")return;if(i===null||typeof i!="object"||!(i.userId||i.anonymousId||i.attributes)){const c="[Sprig] - Disregarding empty payload provided";return console.warn(c),{success:!1,message:c}}const{userId:s,anonymousId:o,attributes:l}=i;if(e.requireUserIdForTracking&&!window.UserLeap.userId&&!s){const c="[Sprig] - Skipping tracking without userId";return console.warn(c),{success:!1,message:c}}if(!l&&(!s||window.UserLeap.userId===s)&&(!o||window.UserLeap.partnerAnonymousId===o))return{success:!0};const a={};s&&(a.userId=window.UserLeap.userId=s),o&&(a.partnerAnonymousId=window.UserLeap.partnerAnonymousId=o);let u;return l?(l.email&&!Object.prototype.hasOwnProperty.call(l,vt)&&(l[vt]=l.email,delete l.email),I(`Setting attributes: ${JSON.stringify(l)}`),u=await ce(se("1",[xe,Ue],"attributes"),{body:JSON.stringify(l),method:"PUT"}),!u.ok&&u.reportError&&(console.warn("[Sprig] (ERR-432) identifyAndSetAttributes failed",u.error),u.error&&window.UserLeap.reportError("identifyAndSetAttributes",u.error))):u=await ce(se("1",[xe,Ue]),{body:JSON.stringify(a),method:"PUT"}),l&&l[vt]&&(window.UserLeap.email=l[vt]),u.ok&&(s&&ne("uid",s),o&&ne("aid",o)),{success:!!u.ok}},async removeAttributes(i){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig removeAttributes",i),e.mode==="test")return;if(i==null||i.length===0){const o="[Sprig] - Disregarding empty attributes provided";return console.warn(o),{success:!1,message:o}}if(e.requireUserIdForTracking&&!window.UserLeap.userId){const o="[Sprig] - Skipping tracking without userId";return console.warn(o),{success:!1,message:o}}const s=await ce(se("1",[xe,Ue],"attributes"),{body:JSON.stringify({delete:i}),method:"DELETE"});return!s.ok&&s.reportError&&(console.warn("[Sprig] (ERR-433) Remove attributes failed",s.error),s.error&&window.UserLeap.reportError("removeAttributes",s.error)),{success:!!s.ok}},async addSurveyListener(i){C.on(R.SurveyLifeCycle,i)},async removeSurveyListener(i){C.removeListener(R.SurveyLifeCycle,i)},async addListener(i,s){C.on(i,s)},async removeListener(i,s){C.removeListener(i,s)},async removeAllListeners(){C.removeAllListeners()},setPreviewKey(i){!i||typeof i!="string"||te.isStorageAvailable&&i&&te.setItem("sprig.previewKey",i)},async setUserId(i){var l;if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig setUserId",i),i==null){const a=`[Sprig] - Invalid userId ${i}`;return console.warn(a),{success:!1,message:a}}if(e.mode==="test"||i===window.UserLeap.userId)return;window.UserLeap.userId=i;const s=window.UserLeap.visitorId,o=await ce(se("1",[xe,Ue]),{body:JSON.stringify({userId:i}),method:"PUT"});if(!o.ok){o.reportError&&(console.warn("[Sprig] (ERR-420) Failed to set user id",o.error),o.error&&window.UserLeap.reportError("setUserId",o.error));return}s!==window.UserLeap.visitorId&&((l=K.replay)==null||l.clearUserReplayData()),ne("uid",i)},async setPartnerAnonymousId(i){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig setPartnerAnonymousId",i),i==null){const s=`[Sprig] - Invalid partnerAnonymousId ${i}`;return console.warn(s),{success:!1,message:s}}return window.UserLeap.partnerAnonymousId=i,ne("aid",i),{success:!0}},async track(i,s,o={},l=void 0){return t({eventName:i,properties:s,metadata:o,showSurveyCallback:l})},async identifyAndTrack(i){return await t(i)},trackPageView(i,s=void 0,o=void 0,l=!0){Si(i,s,o,l)},applyFeedbackStyles({button:i="",view:s=""}){window.UserLeap.feedbackCustomStyles=s,document.getElementById("sprig-feedback-style")&&Mn(document,i,window.UserLeap.styleNonce),n(document.querySelector(".ul-container-feedback"),s)},applyStyles(i){window.UserLeap.customStyles=i,n(window.UserLeap.container,i)},setWindowDimensions(i,s){var u,c;const o=typeof i=="string"?parseInt(i,10):i,l=typeof s=="string"?parseInt(s,10):s;if(!isNaN(o)&&!isNaN(l)&&(window.UserLeap.windowDimensions={width:o,height:l}),!window.UserLeap.frameId)return;const a=document.getElementById(window.UserLeap.frameId);a&&(window.UserLeap.useMobileStyling&&((u=window.UserLeap.windowDimensions)!=null&&u.width&&(a.style.width=`${window.UserLeap.windowDimensions.width}px`),(c=window.UserLeap.windowDimensions)!=null&&c.height&&(a.style.maxHeight=`${window.UserLeap.windowDimensions.height-20}px`),a.contentDocument&&(a.style.height=String(Uo(a.contentDocument)[0])+"px")),C.emit(R.SurveyDimensions,{name:R.SurveyDimensions,contentFrameWidth:a.clientWidth,contentFrameHeight:a.clientHeight}))},logoutUser(){var i;window.UserLeap.debugMode&&console.info("[DEBUG] Sprig logout"),I(`Logging out user: ${window.UserLeap.userId} / vid: ${window.UserLeap.visitorId}`),window.UserLeap.visitorId=null,window.UserLeap.userId=null,window.UserLeap.partnerAnonymousId=null,window.UserLeap.token=null,window.UserLeap.email=null,te.removeItem("userleap.ids"),te.removeItem("userleap.pageviews"),window.UserLeap._queue.isPaused()&&window.UserLeap._queue.empty(),ki(),(i=K.replay)==null||i.clearUserReplayData(),window.UserLeap._queue.unpause()},teardown(){Zo(),window.UserLeap("dismissActiveSurvey",Le.API),delete window.UserLeap,delete window.Sprig,delete window._Sprig},integrateOptimizely(i,s=!0){var o,l;if(!((l=(o=window.UserLeap)==null?void 0:o._config)!=null&&l.optimizelyEnabled)){console.warn("[SPRIG] Optimizely integration is currently not enabled for your product.");return}try{const a=typeof i=="string"?JSON.parse(i):i;Yt.setOptimizelyExperiment(a,s)}catch(a){console.warn("[Sprig] Error with integrating Optimizely data"),a instanceof Error&&window.UserLeap.reportError("integrateOptimizely",a)}},integrateOptimizelyClient(i){var o,l;if(!((l=(o=window.UserLeap)==null?void 0:o._config)!=null&&l.optimizelyEnabled)){console.warn("[SPRIG] Optimizely integration is currently not enabled for your product.");return}const s=({experiment:a,variation:u})=>{const c={experiments:[{id:a.id,variation:u.key}]};window.UserLeap("integrateOptimizely",c,!1)};i.notificationCenter.addNotificationListener("ACTIVATE:experiment, user_id,attributes, variation, event",s)},importLaunchDarklyData(i){var s,o;if(!((o=(s=window.UserLeap)==null?void 0:s._config)!=null&&o.launchDarklyEnabled)){console.warn("[SPRIG] LaunchDarkly integration is currently not enabled for your product.");return}Kn.setLDFlagsVariations(i)},setVisitorAttribute(i,s){return console.warn("[Sprig] setVisitorAttribute is deprecated. Please use setAttribute"),r.setAttribute(i,s)},async setEmail(i){return r.setAttribute(vt,i)},async setVisitorEmail(i){return console.warn("[Sprig] setVisitorEmail is deprecated. Please use setEmail"),r.setEmail(i)},async _generateVideoUploadUrl(i){return ca(i)},_reportMetric(i,s){bi(i,s)},async _completeSessionReplay({surveyId:i,responseGroupUuid:s,eventDigest:o}){var l;return K.replay?(l=K.replay)==null?void 0:l._completeSessionReplay({surveyId:i,responseGroupUuid:s,eventDigest:o,headers:je(window.UserLeap)}):(window.UserLeap.reportError("_completeSessionReplay",new Error("Replay module not registered")),!1)}};Object.assign(window.UserLeap,r)};async function oa(e){const t=je(window.UserLeap);document.addEventListener("securitypolicyviolation",Un);const n=await Ie(se("1",[xe],"config"),{headers:t}),r="TypeError";if(window.UserLeap.error=n.error,!n.ok&&n.error&&n.error.name===r?(window.UserLeap._API_URL="https://api.sprig.com",window.UserLeap.reportError("sprigDomainRequest",n.error)):document.removeEventListener("securitypolicyviolation",Un),!n.ok)return n.reportError&&(console.warn("[Sprig] (ERR-422) Failed to load configuration",n.error),n.error&&window.UserLeap.reportError("applyRemoteConfig",n.error)),xn("Disabled: failed to fetch configuration"),e;const i=n.json;return i!=null&&i.disabled?(xn(`Disabled: ${i.disabled}`),{disabled:i.disabled}):Object.assign({},i,e)}const aa=e=>typeof e=="object"&&e&&"inner"in e&&!!e.inner&&typeof e.inner=="object";async function la(e,t,n={}){var p,d;const r=window.__cfg&&window.__cfg.mode,i=Cn(),s=window.UserLeap.envId,o=window.document.documentElement,l=aa(t)?{inner:{message:(p=t.inner)==null?void 0:p.message,stack:(d=t.inner)==null?void 0:d.stack}}:{},a={mode:r,screenWidth:window.screen.width,screenHeight:window.screen.height,clientWidth:o.clientWidth,clientHeight:o.clientHeight,location:window.location.href,language:window.navigator.language,...n,...l},u={action:e,err:{message:t.message,stack:t.stack},meta:a,vid:i,envId:s},c=await ce(se("1",null,"errors"),{method:"POST",headers:{"x-ul-error":window.btoa(`userleap-${Date.now()}-error`)},body:JSON.stringify(u),shouldDropOnRateLimit:!0});if(!c.ok)console.warn("[Sprig] (ERR-444) Failed to report error to API",t);else{const{presignedUrl:h}=c.json;yo(h)}}async function ca(e){var n;if(!e)return;const t=`${window.UserLeap._API_URL}/2/environments/integrations/upload`;try{const r=await fetch(t,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok){const i=await r.json();return(n=i==null?void 0:i.upload)==null?void 0:n.url}else return null}catch(r){console.warn("[Sprig] Error with generating video upload url"),r instanceof Error&&window.UserLeap.reportError("generateVideoUploadUrl",r)}}function ua(e={}){const t=new URLSearchParams(window.location.search).get("sprigPreviewKey")??"";window.UserLeap.UPDATES=jt,window.UserLeap("setPreviewKey",t);async function n(){var l;if(window.UserLeap.loaded)return;if(I("Loading sprig on page load"),window.UserLeap.reportError=la,window.UserLeap.loaded=!0,window.UserLeap._config=Object.assign({},e,window.UserLeap.config),window.UserLeap.delayingSurvey=!1,window.UserLeap._config&&typeof window.UserLeap._config=="object")for(const a in window.UserLeap._config)window.UserLeap[a]=window.UserLeap._config[a];if(!window.UserLeap.envId)if(window.UserLeap.appId)window.UserLeap.envId=window.UserLeap.appId;else throw new Error("Missing Environment id");window.UserLeap.debugMode&&console.info("[DEBUG] Sprig debug mode enabled");const r=window.UserLeap.sampleRate;if(r){let a=$e("sampled");if(a===null&&(a=Math.random()<r,ne("sampled",a)),!a)return}else $e("sampled")!==null&&ne("sampled",null);window.UserLeap._API_URL||(window.UserLeap._API_URL="https://api.sprig.com");const i=[...window.UserLeap._queue];window.UserLeap._queue=new No(window.UserLeap,[]),window.UserLeap._queue.pause();for(let a=0;a<i.length;a++)window.UserLeap._queue.push(i[a]);const s=$e("token");s?(window.UserLeap.token=s,window.UserLeap.visitorId=$e("vid"),window.UserLeap.userId=$e("uid"),window.UserLeap.partnerAnonymousId=$e("aid")):(te.removeItem("userleap.ids"),ki());const o=await oa(e);zo({webMetricsEnabled:o.metricsReportingEnabled,reportingIntervalSeconds:o.metricsReportingEnabled||o.mobileMetricsReportingEnabled?o.metricsReportingIntervalSeconds:0,thresholds:o.metricThresholds,postMetrics:async a=>{var u;await ce(se("1",[xe],"metrics"),{body:a,method:"POST",headers:{"x-ul-replay-enabled":`${!!((u=K.replay)!=null&&u.isReplayRecording())}`},shouldDropOnRateLimit:!0})}}),(l=K.replay)==null||l.initializeReplay({viewDocument:window.document,maxReplayDurationSeconds:o.maxReplayDurationSeconds,replayNonce:window.UserLeap.replayNonce,maxInflightRequests:window.UserLeap.maxInflightReplayRequests??2,replaySettings:o.replaySettings}),go(o.logBufferLimit,o.logLevel),sa(o),await ra(o),window.UserLeap._queue.unpause(),C.emit(R.SDKReady,{mobileMetricsReportingEnabled:!!o.mobileMetricsReportingEnabled,metricsReportingInterval:o.metricsReportingIntervalSeconds||0,metricsThresholds:o.metricThresholds||[],maxMobileReplayDurationSeconds:o.maxMobileReplayDurationSeconds,mobileReplaySettings:o.mobileReplaySettings}),C.emit(R.VisitorIDUpdated,{visitorId:window.UserLeap.visitorId})}document.readyState==="complete"?n():window.attachEvent?window.attachEvent("onload",n):window.addEventListener("load",()=>{n()},!1)}var Qt=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(Qt||{});class da{constructor(t){q(this,"awaitingResolvers",[]);q(this,"activeCount",0);this.capacity=t}async acquire(){if(this.activeCount<this.capacity){this.activeCount++;return}return new Promise(t=>{this.awaitingResolvers.push(t)})}release(){const t=this.awaitingResolvers.shift();t&&this.activeCount<=this.capacity?t():this.activeCount--}async execute(t){try{return await this.acquire(),await t()}finally{this.release()}}setLimit(t){this.capacity=t}}const Li=new da(2),pa=e=>Li.setLimit(e),ha=async e=>Li.execute(async()=>{var r;I(`Beginning upload of chunk ${e.chunkIndex} for survey: ${e.surveyId}`);const t=await Ie(e.uploadUrl,{body:e.data,method:"PUT"});I(`Completed upload of chunk ${e.chunkIndex} for survey: ${e.surveyId}`);const n=(r=t.headers)==null?void 0:r.get("ETag");if(!n)throw new Error(`Upload response did not include etag for upload ${e.uploadId}, part ${e.chunkIndex}`);return n}),Ii=async({apiUrl:e,surveyId:t,uploadId:n,etags:r,headers:i,responseGroupUuid:s,replayDuration:o,eventDigest:l},a=!1)=>{var c;if(!a&&!n&&!r){I(`Cannot mark upload complete: isMobile: ${a} / uploadId: ${n} / etags: ${r}`);return}I(`Marking upload complete for survey: ${t}`);const u=await Ie(`${e}/sdk/1/completeSessionReplay`,{method:"POST",body:JSON.stringify({etags:r,uploadId:n,responseGroupUuid:s,surveyId:t,replayDuration:o,eventDigest:l,userAgent:(c=window==null?void 0:window.navigator)==null?void 0:c.userAgent}),headers:i,shouldRetryRequest:!0});return I(`Done marking upload complete for survey: ${t}`),u},B=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,$=Object.keys,J=Array.isArray;function Z(e,t){return typeof t!="object"||$(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||B.Promise||(B.Promise=Promise);const _t=Object.getPrototypeOf,fa={}.hasOwnProperty;function re(e,t){return fa.call(e,t)}function nt(e,t){typeof t=="function"&&(t=t(_t(e))),(typeof Reflect>"u"?$:Reflect.ownKeys)(t).forEach(n=>{ye(e,n,t[n])})}const Ui=Object.defineProperty;function ye(e,t,n,r){Ui(e,t,Z(n&&re(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function rt(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ye(e.prototype,"constructor",e),{extend:nt.bind(null,e.prototype)}}}}const ma=Object.getOwnPropertyDescriptor;function zn(e,t){let n;return ma(e,t)||(n=_t(e))&&zn(n,t)}const ya=[].slice;function Xt(e,t,n){return ya.call(e,t,n)}function xi(e,t){return t(e)}function Et(e){if(!e)throw new Error("Assertion Failed")}function Ai(e){B.setImmediate?setImmediate(e):setTimeout(e,0)}function Ri(e,t){return e.reduce((n,r,i)=>{var s=t(r,i);return s&&(n[s[0]]=s[1]),n},{})}function ge(e,t){if(typeof t=="string"&&re(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var s=ge(e,t[r]);n.push(s)}return n}var o=t.indexOf(".");if(o!==-1){var l=e[t.substr(0,o)];return l==null?void 0:ge(l,t.substr(o+1))}}function oe(e,t,n){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Et(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)oe(e,t[r],n[r])}else{var s=t.indexOf(".");if(s!==-1){var o=t.substr(0,s),l=t.substr(s+1);if(l==="")n===void 0?J(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var a=e[o];a&&re(e,o)||(a=e[o]={}),oe(a,l,n)}}else n===void 0?J(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Ci(e){var t={};for(var n in e)re(e,n)&&(t[n]=e[n]);return t}const ga=[].concat;function Pi(e){return ga.apply([],e)}const Di="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Pi([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>B[e]),wa=Di.map(e=>B[e]);Ri(Di,e=>[e,!0]);let Ae=null;function kt(e){Ae=typeof WeakMap<"u"&&new WeakMap;const t=Gn(e);return Ae=null,t}function Gn(e){if(!e||typeof e!="object")return e;let t=Ae&&Ae.get(e);if(t)return t;if(J(e)){t=[],Ae&&Ae.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Gn(e[n]))}else if(wa.indexOf(e.constructor)>=0)t=e;else{const s=_t(e);for(var i in t=s===Object.prototype?{}:Object.create(s),Ae&&Ae.set(e,t),e)re(e,i)&&(t[i]=Gn(e[i]))}return t}const{toString:va}={};function Yn(e){return va.call(e).slice(8,-1)}const Jn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ba=typeof Jn=="symbol"?function(e){var t;return e!=null&&(t=e[Jn])&&t.apply(e)}:function(){return null},it={};function we(e){var t,n,r,i;if(arguments.length===1){if(J(e))return e.slice();if(this===it&&typeof e=="string")return[e];if(i=ba(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(e==null)return[e];if(typeof(t=e.length)=="number"){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const Qn=typeof Symbol<"u"?e=>e[Symbol.toStringTag]==="AsyncFunction":()=>!1;var de=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Oi(e,t){de=e,Ti=t}var Ti=()=>!0;const _a=!new Error("").stack;function qe(){if(_a)try{throw qe.arguments,new Error}catch(e){return e}return new Error}function Xn(e,t){var n=e.stack;return n?(t=t||0,n.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),n.split(`
`).slice(t).filter(Ti).map(r=>`
`+r).join("")):""}var Mi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Zn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Mi),Ea={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function st(e,t){this._e=qe(),this.name=e,this.message=t}function Bi(e,t){return e+". Errors: "+Object.keys(t).map(n=>t[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function Zt(e,t,n,r){this._e=qe(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Bi(e,t)}function St(e,t){this._e=qe(),this.name="BulkError",this.failures=Object.keys(t).map(n=>t[n]),this.failuresByPos=t,this.message=Bi(e,t)}rt(st).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Xn(this._e,2))}},toString:function(){return this.name+": "+this.message}}),rt(Zt).from(st),rt(St).from(st);var er=Zn.reduce((e,t)=>(e[t]=t+"Error",e),{});const ka=st;var x=Zn.reduce((e,t)=>{var n=t+"Error";function r(i,s){this._e=qe(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Ea[t]||n,this.inner=null)}return rt(r).from(ka),e[t]=r,e},{});x.Syntax=SyntaxError,x.Type=TypeError,x.Range=RangeError;var Ni=Mi.reduce((e,t)=>(e[t+"Error"]=x[t],e),{}),en=Zn.reduce((e,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=x[t]),e),{});function T(){}function Lt(e){return e}function Sa(e,t){return e==null||e===Lt?t:function(n){return t(e(n))}}function Ve(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function La(e,t){return e===T?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Ve(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Ve(i,this.onerror):i),s!==void 0?s:n}}function Ia(e,t){return e===T?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Ve(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Ve(r,this.onerror):r)}}function Ua(e,t){return e===T?t:function(n){var r=e.apply(this,arguments);Z(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ve(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Ve(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Z(r,o)}}function xa(e,t){return e===T?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function tr(e,t){return e===T?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return t.apply(r,s)})}return t.apply(this,arguments)}}en.ModifyError=Zt,en.DexieError=st,en.BulkError=St;var It={};const Fi=100,[nr,tn,rr]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,_t(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,_t(t),e]})(),ji=tn&&tn.then,nn=nr&&nr.constructor,ir=!!rr;var sr=!1,Aa=rr?()=>{rr.then(an)}:B.setImmediate?setImmediate.bind(null,an):B.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{an(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(an,0)},Ut=function(e,t){xt.push([e,t]),rn&&(Aa(),rn=!1)},or=!0,rn=!0,He=[],sn=[],ar=null,lr=Lt,ot={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ji,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{Ji(e[0],e[1])}catch{}})}},U=ot,xt=[],We=0,on=[];function L(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=T,this._lib=!1;var t=this._PSD=U;if(de&&(this._stackHolder=qe(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==It)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ur(this,this._value))}this._state=null,this._value=null,++t.ref,$i(this,e)}const cr={get:function(){var e=U,t=un;function n(r,i){var s=!e.global&&(e!==U||t!==un);const o=s&&!ve();var l=new L((a,u)=>{dr(this,new Ki(pn(r,e,s,o),pn(i,e,s,o),a,u,e))});return de&&Hi(l,this),l}return n.prototype=It,n},set:function(e){ye(this,"then",e&&e.prototype===It?cr:{get:function(){return e},set:cr.set})}};function Ki(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}function $i(e,t){try{t(n=>{if(e._state===null){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&At();n&&typeof n.then=="function"?$i(e,(i,s)=>{n instanceof L?n._then(i,s):n.then(i,s)}):(e._state=!0,e._value=n,qi(e)),r&&Rt()}},ur.bind(null,e))}catch(n){ur(e,n)}}function ur(e,t){if(sn.push(t),e._state===null){var n=e._lib&&At();t=lr(t),e._state=!1,e._value=t,de&&t!==null&&typeof t=="object"&&!t._promise&&function(r,i,s){try{r.apply(null,s)}catch{}}(()=>{var r=zn(t,"stack");t._promise=e,ye(t,"stack",{get:()=>sr?r&&(r.get?r.get.apply(t):r.value):e.stack})}),function(r){He.some(i=>i._value===r._value)||He.push(r)}(e),qi(e),n&&Rt()}}function qi(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)dr(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),We===0&&(++We,Ut(()=>{--We==0&&pr()},[]))}function dr(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++We,Ut(Ra,[n,e,t])}else e._listeners.push(t)}function Ra(e,t,n){try{ar=t;var r,i=t._value;t._state?r=e(i):(sn.length&&(sn=[]),r=e(i),sn.indexOf(i)===-1&&function(s){for(var o=He.length;o;)if(He[--o]._value===s._value)return void He.splice(o,1)}(t)),n.resolve(r)}catch(s){n.reject(s)}finally{ar=null,--We==0&&pr(),--n.psd.ref||n.psd.finalize()}}function Vi(e,t,n){if(t.length===n)return t;var r="";if(e._state===!1){var i,s,o=e._value;o!=null?(i=o.name||"Error",s=o.message||o,r=Xn(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+r)}return de&&((r=Xn(e._stackHolder,2))&&t.indexOf(r)===-1&&t.push(r),e._prev&&Vi(e._prev,t,n)),t}function Hi(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function an(){At()&&Rt()}function At(){var e=or;return or=!1,rn=!1,e}function Rt(){var e,t,n;do for(;xt.length>0;)for(e=xt,xt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(xt.length>0);or=!0,rn=!0}function pr(){var e=He;He=[],e.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var t=on.slice(0),n=t.length;n;)t[--n]()}function ln(e){return new L(It,!1,e)}function N(e,t){var n=U;return function(){var r=At(),i=U;try{return Ce(n,!0),e.apply(this,arguments)}catch(s){t&&t(s)}finally{Ce(i,!1),r&&Rt()}}}nt(L.prototype,{then:cr,_then:function(e,t){dr(this,new Ki(null,null,e,t,U))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t=="function"?this.then(null,r=>r instanceof t?n(r):ln(r)):this.then(null,r=>r&&r.name===t?n(r):ln(r))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),ln(t)))},stack:{get:function(){if(this._stack)return this._stack;try{sr=!0;var e=Vi(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{sr=!1}}},timeout:function(e,t){return e<1/0?new L((n,r)=>{var i=setTimeout(()=>r(new x.Timeout(t)),e);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ye(L.prototype,Symbol.toStringTag,"Dexie.Promise"),ot.env=Wi(),nt(L,{all:function(){var e=we.apply(null,arguments).map(dn);return new L(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach((i,s)=>L.resolve(i).then(o=>{e[s]=o,--r||t(e)},n))})},resolve:e=>{if(e instanceof L)return e;if(e&&typeof e.then=="function")return new L((n,r)=>{e.then(n,r)});var t=new L(It,!0,e);return Hi(t,ar),t},reject:ln,race:function(){var e=we.apply(null,arguments).map(dn);return new L((t,n)=>{e.map(r=>L.resolve(r).then(t,n))})},PSD:{get:()=>U,set:e=>U=e},totalEchoes:{get:()=>un},newPSD:Re,usePSD:lt,scheduler:{get:()=>Ut,set:e=>{Ut=e}},rejectionMapper:{get:()=>lr,set:e=>{lr=e}},follow:(e,t)=>new L((n,r)=>Re((i,s)=>{var o=U;o.unhandleds=[],o.onunhandled=s,o.finalize=Ve(function(){(function(l){function a(){l(),on.splice(on.indexOf(a),1)}on.push(a),++We,Ut(()=>{--We==0&&pr()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),e()},t,n,r))}),nn&&(nn.allSettled&&ye(L,"allSettled",function(){const e=we.apply(null,arguments).map(dn);return new L(t=>{e.length===0&&t([]);let n=e.length;const r=new Array(n);e.forEach((i,s)=>L.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||t(r)))})}),nn.any&&typeof AggregateError<"u"&&ye(L,"any",function(){const e=we.apply(null,arguments).map(dn);return new L((t,n)=>{e.length===0&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach((s,o)=>L.resolve(s).then(l=>t(l),l=>{i[o]=l,--r||n(new AggregateError(i))}))})}));const Q={awaits:0,echoes:0,id:0};var Ca=0,cn=[],hr=0,un=0,Pa=0;function Re(e,t,n,r){var i=U,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Pa;var o=ot.env;s.env=ir?{Promise:L,PromiseProp:{value:L,configurable:!0,writable:!0},all:L.all,race:L.race,allSettled:L.allSettled,any:L.any,resolve:L.resolve,reject:L.reject,nthen:Gi(o.nthen,s),gthen:Gi(o.gthen,s)}:{},t&&Z(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=lt(s,e,n,r);return s.ref===0&&s.finalize(),l}function at(){return Q.id||(Q.id=++Ca),++Q.awaits,Q.echoes+=Fi,Q.id}function ve(){return!!Q.awaits&&(--Q.awaits==0&&(Q.id=0),Q.echoes=Q.awaits*Fi,!0)}function dn(e){return Q.echoes&&e&&e.constructor===nn?(at(),e.then(t=>(ve(),t),t=>(ve(),V(t)))):e}function Da(e){++un,Q.echoes&&--Q.echoes!=0||(Q.echoes=Q.id=0),cn.push(U),Ce(e,!0)}function Oa(){var e=cn[cn.length-1];cn.pop(),Ce(e,!1)}function Ce(e,t){var n=U;if((t?!Q.echoes||hr++&&e===U:!hr||--hr&&e===U)||zi(t?Da.bind(null,e):Oa),e!==U&&(U=e,n===ot&&(ot.env=Wi()),ir)){var r=ot.env.Promise,i=e.env;tn.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(B,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Wi(){var e=B.Promise;return ir?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(B,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:tn.then,gthen:e.prototype.then}:{}}function lt(e,t,n,r,i){var s=U;try{return Ce(e,!0),t(n,r,i)}finally{Ce(s,!1)}}function zi(e){ji.call(nr,e)}function pn(e,t,n,r){return typeof e!="function"?e:function(){var i=U;n&&at(),Ce(t,!0);try{return e.apply(this,arguments)}finally{Ce(i,!1),r&&zi(ve)}}}function Gi(e,t){return function(n,r){return e.call(this,pn(n,t),pn(r,t))}}(""+ji).indexOf("[native code]")===-1&&(at=ve=T);const Yi="unhandledrejection";function Ji(e,t){var n;try{n=t.onuncatched(e)}catch{}if(n!==!1)try{var r,i={promise:t,reason:e};if(B.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Yi,!0,!0),Z(r,i)):B.CustomEvent&&Z(r=new CustomEvent(Yi,{detail:i}),i),r&&B.dispatchEvent&&(dispatchEvent(r),!B.PromiseRejectionEvent&&B.onunhandledrejection))try{B.onunhandledrejection(r)}catch{}de&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var V=L.reject;function fr(e,t,n,r){if(e.idbdb&&(e._state.openComplete||U.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(s){return s.name===er.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>fr(e,t,n,r))):V(s)}return i._promise(t,(s,o)=>Re(()=>(U.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}if(e._state.openComplete)return V(new x.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return V(new x.DatabaseClosed);e.open().catch(T)}return e._state.dbReadyPromise.then(()=>fr(e,t,n,r))}const Qi="3.2.7",ze="",mr=-1/0,be="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Xi="String expected.",Ct=[],hn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ta=hn,Ma=hn,Zi=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),fn="__dbnames",yr="readonly",gr="readwrite";function Ge(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const es={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function mn(e){return typeof e!="string"||/\./.test(e)?t=>t:t=>(t[e]===void 0&&e in t&&delete(t=kt(t))[e],t)}class Ba{_trans(t,n,r){const i=this._tx||U.trans,s=this.name;function o(a,u,c){if(!c.schema[s])throw new x.NotFound("Table "+s+" not part of transaction");return n(c.idbtrans,c)}const l=At();try{return i&&i.db===this.db?i===U.trans?i._promise(t,o,r):Re(()=>i._promise(t,o,r),{trans:i,transless:U.transless||U}):fr(this.db,t,[this.name],o)}finally{l&&Rt()}}get(t,n){return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:t}).then(i=>this.hook.reading.fire(i))).then(n)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(J(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const n=$(t);if(n.length===1)return this.where(n[0]).equals(t[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(u=>{if(u.compound&&n.every(c=>u.keyPath.indexOf(c)>=0)){for(let c=0;c<n.length;++c)if(n.indexOf(u.keyPath[c])===-1)return!1;return!0}return!1}).sort((u,c)=>u.keyPath.length-c.keyPath.length)[0];if(r&&this.db._maxKey!==ze){const u=r.keyPath.slice(0,n.length);return this.where(u).equals(u.map(c=>t[c]))}!r&&de&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(u,c){try{return s.cmp(u,c)===0}catch{return!1}}const[l,a]=n.reduce(([u,c],p)=>{const d=i[p],h=t[p];return[u||d,u||!d?Ge(c,d&&d.multi?g=>{const m=ge(g,p);return J(m)&&m.some(v=>o(h,v))}:g=>o(h,ge(g,p))):c]},[null,null]);return l?this.where(l.name).equals(t[l.keyPath]).filter(a):r?this.filter(a):this.where(n).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,J(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const n=r=>{if(!r)return r;const i=Object.create(t.prototype);for(var s in r)if(re(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),t}defineClass(){return this.mapToClass(function(t){Z(this,t)})}add(t,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=t;return i&&r&&(s=mn(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[s]})).then(o=>o.numFailures?L.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{oe(t,i,o)}catch{}return o})}update(t,n){if(typeof t!="object"||J(t))return this.where(":id").equals(t).modify(n);{const r=ge(t,this.schema.primKey.keyPath);if(r===void 0)return V(new x.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?$(n).forEach(i=>{oe(t,i,n[i])}):n(t,{value:t,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(t,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=t;return i&&r&&(s=mn(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:n!=null?[n]:null})).then(o=>o.numFailures?L.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{oe(t,i,o)}catch{}return o})}delete(t){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[t]})).then(n=>n.numFailures?L.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:es})).then(t=>t.numFailures?L.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",n=>this.core.getMany({keys:t,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(t,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:l,keyPath:a}=this.schema.primKey;if(a&&i)throw new x.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new x.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let c=a&&l?t.map(mn(a)):t;return this.core.mutate({trans:o,type:"add",keys:i,values:c,wantResults:s}).then(({numFailures:p,results:d,lastResult:h,failures:g})=>{if(p===0)return s?d:h;throw new St(`${this.name}.bulkAdd(): ${p} of ${u} operations failed`,g)})})}bulkPut(t,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:l,keyPath:a}=this.schema.primKey;if(a&&i)throw new x.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new x.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let c=a&&l?t.map(mn(a)):t;return this.core.mutate({trans:o,type:"put",keys:i,values:c,wantResults:s}).then(({numFailures:p,results:d,lastResult:h,failures:g})=>{if(p===0)return s?d:h;throw new St(`${this.name}.bulkPut(): ${p} of ${u} operations failed`,g)})})}bulkDelete(t){const n=t.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:t})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new St(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}}function Pt(e){var t={},n=function(o,l){if(l){for(var a=arguments.length,u=new Array(a-1);--a;)u[a-1]=arguments[a];return t[o].subscribe.apply(null,u),e}if(typeof o=="string")return t[o]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(o,l,a){if(typeof o!="object"){var u;l||(l=xa),a||(a=T);var c={subscribers:[],fire:a,subscribe:function(p){c.subscribers.indexOf(p)===-1&&(c.subscribers.push(p),c.fire=l(c.fire,p))},unsubscribe:function(p){c.subscribers=c.subscribers.filter(function(d){return d!==p}),c.fire=c.subscribers.reduce(l,a)}};return t[o]=n[o]=c,c}$(u=o).forEach(function(p){var d=u[p];if(J(d))s(p,u[p][0],u[p][1]);else{if(d!=="asap")throw new x.InvalidArgument("Invalid event config");var h=s(p,Lt,function(){for(var g=arguments.length,m=new Array(g);g--;)m[g]=arguments[g];h.subscribers.forEach(function(v){Ai(function(){v.apply(null,m)})})})}})}}function Dt(e,t){return rt(t).from({prototype:e}),t}function ct(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function wr(e,t){e.filter=Ge(e.filter,t)}function vr(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Ge(r(),t()):t,e.justLimit=n&&!r}function yn(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new x.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function ts(e,t,n){const r=yn(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function gn(e,t,n,r){const i=e.replayFilter?Ge(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(l,a,u)=>{if(!i||i(a,u,d=>a.stop(d),d=>a.fail(d))){var c=a.primaryKey,p=""+c;p==="[object ArrayBuffer]"&&(p=""+new Uint8Array(c)),re(s,p)||(s[p]=!0,t(l,a,u))}};return Promise.all([e.or._iterate(o,n),ns(ts(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return ns(ts(e,r,n),Ge(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function ns(e,t,n,r){var i=N(r?(s,o,l)=>n(r(s),o,l):n);return e.then(s=>{if(s)return s.start(()=>{var o=()=>s.continue();t&&!t(s,l=>o=l,l=>{s.stop(l),o=T},l=>{s.fail(l),o=T})||i(s.value,s,l=>o=l),o()})})}function ee(e,t){try{const n=rs(e),r=rs(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(i,s){const o=i.length,l=s.length,a=o<l?o:l;for(let u=0;u<a;++u)if(i[u]!==s[u])return i[u]<s[u]?-1:1;return o===l?0:o<l?-1:1}(is(e),is(t));case"Array":return function(i,s){const o=i.length,l=s.length,a=o<l?o:l;for(let u=0;u<a;++u){const c=ee(i[u],s[u]);if(c!==0)return c}return o===l?0:o<l?-1:1}(e,t)}}catch{}return NaN}function rs(e){const t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";const n=Yn(e);return n==="ArrayBuffer"?"binary":n}function is(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Na{_read(t,n){var r=this._ctx;return r.error?r.table._trans(null,V.bind(null,r.error)):r.table._trans("readonly",t).then(n)}_write(t){var n=this._ctx;return n.error?n.table._trans(null,V.bind(null,n.error)):n.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var n=this._ctx;n.algorithm=Ge(n.algorithm,t)}_iterate(t,n){return gn(this._ctx,t,n,this._ctx.table.core)}clone(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&Z(r,t),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(t){var n=this._ctx;return this._read(r=>gn(n,t,r,n.table.core))}count(t){return this._read(n=>{const r=this._ctx,i=r.table.core;if(ct(r,!0))return i.count({trans:n,query:{index:yn(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return gn(r,()=>(++s,!1),n,i).then(()=>s)}).then(t)}sortBy(t,n){const r=t.split(".").reverse(),i=r[0],s=r.length-1;function o(u,c){return c?o(u[r[c]],c-1):u[i]}var l=this._ctx.dir==="next"?1:-1;function a(u,c){var p=o(u,s),d=o(c,s);return p<d?-l:p>d?l:0}return this.toArray(function(u){return u.sort(a)}).then(n)}toArray(t){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&ct(r,!0)&&r.limit>0){const{valueMapper:i}=r,s=yn(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return gn(r,s=>i.push(s),n,r.table.core).then(()=>i)}},t)}offset(t){var n=this._ctx;return t<=0||(n.offset+=t,ct(n)?vr(n,()=>{var r=t;return(i,s)=>r===0||(r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1))}):vr(n,()=>{var r=t;return()=>--r<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),vr(this._ctx,()=>{var n=t;return function(r,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(t,n){return wr(this._ctx,function(r,i,s){return!t(r.value)||(i(s),n)}),this}first(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var n,r;return wr(this._ctx,function(i){return t(i.value)}),n=this._ctx,r=t,n.isMatch=Ge(n.isMatch,r),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.primaryKey,i)})}keys(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(t)}primaryKeys(t){var n=this._ctx;if(n.dir==="next"&&ct(n,!0)&&n.limit>0)return this._read(i=>{var s=yn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(n){return n[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return wr(this._ctx,function(i){var s=i.primaryKey.toString(),o=re(r,s);return r[s]=!0,!o}),this}modify(t){var n=this._ctx;return this._write(r=>{var i;if(typeof t=="function")i=t;else{var s=$(t),o=s.length;i=function(m){for(var v=!1,y=0;y<o;++y){var f=s[y],b=t[f];ge(m,f)!==b&&(oe(m,f,b),v=!0)}return v}}const l=n.table.core,{outbound:a,extractKey:u}=l.schema.primaryKey,c=this.db._options.modifyChunkSize||200,p=[];let d=0;const h=[],g=(m,v)=>{const{failures:y,numFailures:f}=v;d+=m-f;for(let b of $(y))p.push(y[b])};return this.clone().primaryKeys().then(m=>{const v=y=>{const f=Math.min(c,m.length-y);return l.getMany({trans:r,keys:m.slice(y,y+f),cache:"immutable"}).then(b=>{const k=[],E=[],_=a?[]:null,w=[];for(let S=0;S<f;++S){const F=b[S],D={value:kt(F),primKey:m[y+S]};i.call(D,D.value,D)!==!1&&(D.value==null?w.push(m[y+S]):a||ee(u(F),u(D.value))===0?(E.push(D.value),a&&_.push(m[y+S])):(w.push(m[y+S]),k.push(D.value)))}const A=ct(n)&&n.limit===1/0&&(typeof t!="function"||t===br)&&{index:n.index,range:n.range};return Promise.resolve(k.length>0&&l.mutate({trans:r,type:"add",values:k}).then(S=>{for(let F in S.failures)w.splice(parseInt(F),1);g(k.length,S)})).then(()=>(E.length>0||A&&typeof t=="object")&&l.mutate({trans:r,type:"put",keys:_,values:E,criteria:A,changeSpec:typeof t!="function"&&t}).then(S=>g(E.length,S))).then(()=>(w.length>0||A&&t===br)&&l.mutate({trans:r,type:"delete",keys:w,criteria:A}).then(S=>g(w.length,S))).then(()=>m.length>y+f&&v(y+c))})};return v(0).then(()=>{if(p.length>0)throw new Zt("Error modifying one or more objects",p,d,h);return m.length})})})}delete(){var t=this._ctx,n=t.range;return ct(t)&&(t.isPrimKey&&!Ma||n.type===3)?this._write(r=>{const{primaryKey:i}=t.table.core.schema,s=n;return t.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>t.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:l,lastResult:a,results:u,numFailures:c})=>{if(c)throw new Zt("Could not delete some values",Object.keys(l).map(p=>l[p]),o-c);return o-c}))}):this.modify(br)}}const br=(e,t)=>t.value=null;function Fa(e,t){return e<t?-1:e===t?0:1}function ja(e,t){return e>t?-1:e===t?0:1}function ie(e,t,n){var r=e instanceof os?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function ut(e){return new e.Collection(e,()=>ss("")).limit(0)}function Ka(e,t,n,r,i,s){for(var o=Math.min(e.length,r.length),l=-1,a=0;a<o;++a){var u=t[a];if(u!==r[a])return i(e[a],n[a])<0?e.substr(0,a)+n[a]+n.substr(a+1):i(e[a],r[a])<0?e.substr(0,a)+r[a]+n.substr(a+1):l>=0?e.substr(0,l)+t[l]+n.substr(l+1):null;i(e[a],u)<0&&(l=a)}return o<r.length&&s==="next"?e+n.substr(e.length):o<e.length&&s==="prev"?e.substr(0,n.length):l<0?null:e.substr(0,l)+r[l]+n.substr(l+1)}function wn(e,t,n,r){var i,s,o,l,a,u,c,p=n.length;if(!n.every(m=>typeof m=="string"))return ie(e,Xi);function d(m){i=function(y){return y==="next"?f=>f.toUpperCase():f=>f.toLowerCase()}(m),s=function(y){return y==="next"?f=>f.toLowerCase():f=>f.toUpperCase()}(m),o=m==="next"?Fa:ja;var v=n.map(function(y){return{lower:s(y),upper:i(y)}}).sort(function(y,f){return o(y.lower,f.lower)});l=v.map(function(y){return y.upper}),a=v.map(function(y){return y.lower}),u=m,c=m==="next"?"":r}d("next");var h=new e.Collection(e,()=>Pe(l[0],a[p-1]+r));h._ondirectionchange=function(m){d(m)};var g=0;return h._addAlgorithm(function(m,v,y){var f=m.key;if(typeof f!="string")return!1;var b=s(f);if(t(b,a,g))return!0;for(var k=null,E=g;E<p;++E){var _=Ka(f,b,l[E],a[E],o,u);_===null&&k===null?g=E+1:(k===null||o(k,_)>0)&&(k=_)}return v(k!==null?function(){m.continue(k+c)}:y),!1}),h}function Pe(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ss(e){return{type:1,lower:e,upper:e}}class os{get Collection(){return this._ctx.table.db.Collection}between(t,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(t,n)>0||this._cmp(t,n)===0&&(r||i)&&(!r||!i)?ut(this):new this.Collection(this,()=>Pe(t,n,!r,!i))}catch{return ie(this,be)}}equals(t){return t==null?ie(this,be):new this.Collection(this,()=>ss(t))}above(t){return t==null?ie(this,be):new this.Collection(this,()=>Pe(t,void 0,!0))}aboveOrEqual(t){return t==null?ie(this,be):new this.Collection(this,()=>Pe(t,void 0,!1))}below(t){return t==null?ie(this,be):new this.Collection(this,()=>Pe(void 0,t,!1,!0))}belowOrEqual(t){return t==null?ie(this,be):new this.Collection(this,()=>Pe(void 0,t))}startsWith(t){return typeof t!="string"?ie(this,Xi):this.between(t,t+ze,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):wn(this,(n,r)=>n.indexOf(r[0])===0,[t],ze)}equalsIgnoreCase(t){return wn(this,(n,r)=>n===r[0],[t],"")}anyOfIgnoreCase(){var t=we.apply(it,arguments);return t.length===0?ut(this):wn(this,(n,r)=>r.indexOf(n)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=we.apply(it,arguments);return t.length===0?ut(this):wn(this,(n,r)=>r.some(i=>n.indexOf(i)===0),t,ze)}anyOf(){const t=we.apply(it,arguments);let n=this._cmp;try{t.sort(n)}catch{return ie(this,be)}if(t.length===0)return ut(this);const r=new this.Collection(this,()=>Pe(t[0],t[t.length-1]));r._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,t.sort(n)};let i=0;return r._addAlgorithm((s,o,l)=>{const a=s.key;for(;n(a,t[i])>0;)if(++i,i===t.length)return o(l),!1;return n(a,t[i])===0||(o(()=>{s.continue(t[i])}),!1)}),r}notEqual(t){return this.inAnyRange([[mr,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=we.apply(it,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return ie(this,be)}const n=t.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[mr,i]],null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,n){const r=this._cmp,i=this._ascending,s=this._descending,o=this._min,l=this._max;if(t.length===0)return ut(this);if(!t.every(f=>f[0]!==void 0&&f[1]!==void 0&&i(f[0],f[1])<=0))return ie(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",x.InvalidArgument);const a=!n||n.includeLowers!==!1,u=n&&n.includeUppers===!0;let c,p=i;function d(f,b){return p(f[0],b[0])}try{c=t.reduce(function(f,b){let k=0,E=f.length;for(;k<E;++k){const _=f[k];if(r(b[0],_[1])<0&&r(b[1],_[0])>0){_[0]=o(_[0],b[0]),_[1]=l(_[1],b[1]);break}}return k===E&&f.push(b),f},[]),c.sort(d)}catch{return ie(this,be)}let h=0;const g=u?f=>i(f,c[h][1])>0:f=>i(f,c[h][1])>=0,m=a?f=>s(f,c[h][0])>0:f=>s(f,c[h][0])>=0;let v=g;const y=new this.Collection(this,()=>Pe(c[0][0],c[c.length-1][1],!a,!u));return y._ondirectionchange=f=>{f==="next"?(v=g,p=i):(v=m,p=s),c.sort(d)},y._addAlgorithm((f,b,k)=>{for(var E=f.key;v(E);)if(++h,h===c.length)return b(k),!1;return!!function(_){return!g(_)&&!m(_)}(E)||(this._cmp(E,c[h][1])===0||this._cmp(E,c[h][0])===0||b(()=>{p===i?f.continue(c[h][0]):f.continue(c[h][1])}),!1)}),y}startsWithAnyOf(){const t=we.apply(it,arguments);return t.every(n=>typeof n=="string")?t.length===0?ut(this):this.inAnyRange(t.map(n=>[n,n+ze])):ie(this,"startsWithAnyOf() only works with strings")}}function pe(e){return N(function(t){return Ot(t),e(t.target.error),!1})}function Ot(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Tt="storagemutated",De="x-storagemutated-1",Oe=Pt(null,Tt);class $a{_lock(){return Et(!U.global),++this._reculock,this._reculock!==1||U.global||(U.lockOwnerFor=this),this}_unlock(){if(Et(!U.global),--this._reculock==0)for(U.global||(U.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{lt(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&U.lockOwnerFor!==this}create(t){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Et(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new x.DatabaseClosed(r);case"MissingAPIError":throw new x.MissingAPI(r.message,r);default:throw new x.OpenFailed(r)}if(!this.active)throw new x.TransactionInactive;return Et(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=N(i=>{Ot(i),this._reject(t.error)}),t.onabort=N(i=>{Ot(i),this.active&&this._reject(new x.Abort(t.error)),this.active=!1,this.on("abort").fire(i)}),t.oncomplete=N(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Oe.storagemutated.fire(t.mutatedParts)}),this}_promise(t,n,r){if(t==="readwrite"&&this.mode!=="readwrite")return V(new x.ReadOnly("Transaction is readonly"));if(!this.active)return V(new x.TransactionInactive);if(this._locked())return new L((s,o)=>{this._blockedFuncs.push([()=>{this._promise(t,n,r).then(s,o)},U])});if(r)return Re(()=>{var s=new L((o,l)=>{this._lock();const a=n(o,l,this);a&&a.then&&a.then(o,l)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new L((s,o)=>{var l=n(s,o,this);l&&l.then&&l.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var n=this._root();const r=L.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=n._waitingFor;return new L((o,l)=>{r.then(a=>n._waitingQueue.push(N(o.bind(null,a))),a=>n._waitingQueue.push(N(l.bind(null,a)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new x.Abort))}table(t){const n=this._memoizedTables||(this._memoizedTables={});if(re(n,t))return n[t];const r=this.schema[t];if(!r)throw new x.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,r,this);return i.core=this.db.core.table(t),n[t]=i,i}}function _r(e,t,n,r,i,s,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+as(t)}}function as(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ls(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:Ri(n,r=>[r.name,r])}}let Mt=e=>{try{return e.only([[]]),Mt=()=>[[]],[[]]}catch{return Mt=()=>ze,ze}};function Er(e){return e==null?()=>{}:typeof e=="string"?function(t){return t.split(".").length===1?r=>r[t]:r=>ge(r,t)}(e):t=>ge(t,e)}function cs(e){return[].slice.call(e)}let qa=0;function Bt(e){return e==null?":id":typeof e=="string"?e:`[${e.join("+")}]`}function Va(e,t,n){function r(a){if(a.type===3)return null;if(a.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:c,lowerOpen:p,upperOpen:d}=a;return u===void 0?c===void 0?null:t.upperBound(c,!!d):c===void 0?t.lowerBound(u,!!p):t.bound(u,c,!!p,!!d)}const{schema:i,hasGetAll:s}=function(a,u){const c=cs(a.objectStoreNames);return{schema:{name:a.name,tables:c.map(p=>u.objectStore(p)).map(p=>{const{keyPath:d,autoIncrement:h}=p,g=J(d),m=d==null,v={},y={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:g,keyPath:d,autoIncrement:h,unique:!0,extractKey:Er(d)},indexes:cs(p.indexNames).map(f=>p.index(f)).map(f=>{const{name:b,unique:k,multiEntry:E,keyPath:_}=f,w={name:b,compound:J(_),keyPath:_,unique:k,multiEntry:E,extractKey:Er(_)};return v[Bt(_)]=w,w}),getIndexByKeyPath:f=>v[Bt(f)]};return v[":id"]=y.primaryKey,d!=null&&(v[Bt(d)]=y.primaryKey),y})},hasGetAll:c.length>0&&"getAll"in u.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=i.tables.map(a=>function(u){const c=u.name;return{name:c,schema:u,mutate:function({trans:p,type:d,keys:h,values:g,range:m}){return new Promise((v,y)=>{v=N(v);const f=p.objectStore(c),b=f.keyPath==null,k=d==="put"||d==="add";if(!k&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:E}=h||g||{length:1};if(h&&g&&h.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return v({numFailures:0,failures:{},results:[],lastResult:void 0});let _;const w=[],A=[];let S=0;const F=z=>{++S,Ot(z)};if(d==="deleteRange"){if(m.type===4)return v({numFailures:S,failures:A,results:[],lastResult:void 0});m.type===3?w.push(_=f.clear()):w.push(_=f.delete(r(m)))}else{const[z,H]=k?b?[g,h]:[g,null]:[h,null];if(k)for(let M=0;M<E;++M)w.push(_=H&&H[M]!==void 0?f[d](z[M],H[M]):f[d](z[M])),_.onerror=F;else for(let M=0;M<E;++M)w.push(_=f[d](z[M])),_.onerror=F}const D=z=>{const H=z.target.result;w.forEach((M,Se)=>M.error!=null&&(A[Se]=M.error)),v({numFailures:S,failures:A,results:d==="delete"?h:w.map(M=>M.result),lastResult:H})};_.onerror=z=>{F(z),D(z)},_.onsuccess=D})},getMany:({trans:p,keys:d})=>new Promise((h,g)=>{h=N(h);const m=p.objectStore(c),v=d.length,y=new Array(v);let f,b=0,k=0;const E=w=>{const A=w.target;y[A._pos]=A.result,++k===b&&h(y)},_=pe(g);for(let w=0;w<v;++w)d[w]!=null&&(f=m.get(d[w]),f._pos=w,f.onsuccess=E,f.onerror=_,++b);b===0&&h(y)}),get:({trans:p,key:d})=>new Promise((h,g)=>{h=N(h);const m=p.objectStore(c).get(d);m.onsuccess=v=>h(v.target.result),m.onerror=pe(g)}),query:function(p){return d=>new Promise((h,g)=>{h=N(h);const{trans:m,values:v,limit:y,query:f}=d,b=y===1/0?void 0:y,{index:k,range:E}=f,_=m.objectStore(c),w=k.isPrimaryKey?_:_.index(k.name),A=r(E);if(y===0)return h({result:[]});if(p){const S=v?w.getAll(A,b):w.getAllKeys(A,b);S.onsuccess=F=>h({result:F.target.result}),S.onerror=pe(g)}else{let S=0;const F=v||!("openKeyCursor"in w)?w.openCursor(A):w.openKeyCursor(A),D=[];F.onsuccess=z=>{const H=F.result;return H?(D.push(v?H.value:H.primaryKey),++S===y?h({result:D}):void H.continue()):h({result:D})},F.onerror=pe(g)}})}(s),openCursor:function({trans:p,values:d,query:h,reverse:g,unique:m}){return new Promise((v,y)=>{v=N(v);const{index:f,range:b}=h,k=p.objectStore(c),E=f.isPrimaryKey?k:k.index(f.name),_=g?m?"prevunique":"prev":m?"nextunique":"next",w=d||!("openKeyCursor"in E)?E.openCursor(r(b),_):E.openKeyCursor(r(b),_);w.onerror=pe(y),w.onsuccess=N(A=>{const S=w.result;if(!S)return void v(null);S.___id=++qa,S.done=!1;const F=S.continue.bind(S);let D=S.continuePrimaryKey;D&&(D=D.bind(S));const z=S.advance.bind(S),H=()=>{throw new Error("Cursor not stopped")};S.trans=p,S.stop=S.continue=S.continuePrimaryKey=S.advance=()=>{throw new Error("Cursor not started")},S.fail=N(y),S.next=function(){let M=1;return this.start(()=>M--?this.continue():this.stop()).then(()=>this)},S.start=M=>{const Se=new Promise((G,fe)=>{G=N(G),w.onerror=pe(fe),S.fail=fe,S.stop=Be=>{S.stop=S.continue=S.continuePrimaryKey=S.advance=H,G(Be)}}),he=()=>{if(w.result)try{M()}catch(G){S.fail(G)}else S.done=!0,S.start=()=>{throw new Error("Cursor behind last entry")},S.stop()};return w.onsuccess=N(G=>{w.onsuccess=he,he()}),S.continue=F,S.continuePrimaryKey=D,S.advance=z,he(),Se},v(S)},y)})},count({query:p,trans:d}){const{index:h,range:g}=p;return new Promise((m,v)=>{const y=d.objectStore(c),f=h.isPrimaryKey?y:y.index(h.name),b=r(g),k=b?f.count(b):f.count();k.onsuccess=N(E=>m(E.target.result)),k.onerror=pe(v)})}}}(a)),l={};return o.forEach(a=>l[a.name]=a),{stack:"dbcore",transaction:e.transaction.bind(e),table(a){if(!l[a])throw new Error(`Table '${a}' not found`);return l[a]},MIN_KEY:-1/0,MAX_KEY:Mt(t),schema:i}}function kr({_novip:e},t){const n=t.db,r=function(i,s,{IDBKeyRange:o,indexedDB:l},a){return{dbcore:function(c,p){return p.reduce((d,{create:h})=>({...d,...h(d)}),c)}(Va(s,o,a),i.dbcore)}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(i=>{const s=i.name;e.core.schema.tables.some(o=>o.name===s)&&(i.core=e.core.table(s),e[s]instanceof e.Table&&(e[s].core=i.core))})}function vn({_novip:e},t,n,r){n.forEach(i=>{const s=r[i];t.forEach(o=>{const l=zn(o,i);(!l||"value"in l&&l.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?ye(o,i,{get(){return this.table(i)},set(a){Ui(this,i,{value:a,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new e.Table(i,s))})})}function Sr({_novip:e},t){t.forEach(n=>{for(let r in n)n[r]instanceof e.Table&&delete n[r]})}function Ha(e,t){return e._cfg.version-t._cfg.version}function Wa(e,t,n,r){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),l=U.transless||U;Re(()=>{U.trans=s,U.transless=l,t===0?($(i).forEach(a=>{Lr(n,a,i[a].primKey,i[a].indexes)}),kr(e,n),L.follow(()=>e.on.populate.fire(s)).catch(o)):function({_novip:a},u,c,p){const d=[],h=a._versions;let g=a._dbSchema=Ur(a,a.idbdb,p),m=!1;const v=h.filter(f=>f._cfg.version>=u);function y(){return d.length?L.resolve(d.shift()(c.idbtrans)).then(y):L.resolve()}return v.forEach(f=>{d.push(()=>{const b=g,k=f._cfg.dbschema;xr(a,b,p),xr(a,k,p),g=a._dbSchema=k;const E=us(b,k);E.add.forEach(w=>{Lr(p,w[0],w[1].primKey,w[1].indexes)}),E.change.forEach(w=>{if(w.recreate)throw new x.Upgrade("Not yet support for changing primary key");{const A=p.objectStore(w.name);w.add.forEach(S=>Ir(A,S)),w.change.forEach(S=>{A.deleteIndex(S.name),Ir(A,S)}),w.del.forEach(S=>A.deleteIndex(S))}});const _=f._cfg.contentUpgrade;if(_&&f._cfg.version>u){kr(a,p),c._memoizedTables={},m=!0;let w=Ci(k);E.del.forEach(D=>{w[D]=b[D]}),Sr(a,[a.Transaction.prototype]),vn(a,[a.Transaction.prototype],$(w),w),c.schema=w;const A=Qn(_);let S;A&&at();const F=L.follow(()=>{if(S=_(c),S&&A){var D=ve.bind(null,null);S.then(D,D)}});return S&&typeof S.then=="function"?L.resolve(S):F.then(()=>S)}}),d.push(b=>{(!m||!Ta)&&function(k,E){[].slice.call(E.db.objectStoreNames).forEach(_=>k[_]==null&&E.db.deleteObjectStore(_))}(f._cfg.dbschema,b),Sr(a,[a.Transaction.prototype]),vn(a,[a.Transaction.prototype],a._storeNames,a._dbSchema),c.schema=a._dbSchema})}),y().then(()=>{var f,b;b=p,$(f=g).forEach(k=>{b.db.objectStoreNames.contains(k)||Lr(b,k,f[k].primKey,f[k].indexes)})})}(e,t,s,n).catch(o)})}function us(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],s=t[r];if(i){const o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!hn)o.recreate=!0,n.change.push(o);else{const l=i.idxByName,a=s.idxByName;let u;for(u in l)a[u]||o.del.push(u);for(u in a){const c=l[u],p=a[u];c?c.src!==p.src&&o.change.push(p):o.add.push(p)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,s])}return n}function Lr(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>Ir(i,s)),i}function Ir(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Ur(e,t,n){const r={};return Xt(t.objectStoreNames,0).forEach(i=>{const s=n.objectStore(i);let o=s.keyPath;const l=_r(as(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),a=[];for(let c=0;c<s.indexNames.length;++c){const p=s.index(s.indexNames[c]);o=p.keyPath;var u=_r(p.name,o,!!p.unique,!!p.multiEntry,!1,o&&typeof o!="string",!1);a.push(u)}r[i]=ls(i,l,a)}),r}function xr({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);e._hasGetAll="getAll"in o;for(let l=0;l<o.indexNames.length;++l){const a=o.indexNames[l],u=o.index(a).keyPath,c=typeof u=="string"?u:"["+Xt(u).join("+")+"]";if(t[s]){const p=t[s].idxByName[c];p&&(p.name=a,delete t[s].idxByName[c],t[s].idxByName[a]=p)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&B.WorkerGlobalScope&&B instanceof B.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class za{_parseStoresSpec(t,n){$(t).forEach(r=>{if(t[r]!==null){var i=t[r].split(",").map((o,l)=>{const a=(o=o.trim()).replace(/([&*]|\+\+)/g,""),u=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return _r(a,u||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),J(u),l===0)}),s=i.shift();if(s.multi)throw new x.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new x.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new x.Schema("Index must have a name and cannot be an empty string")}),n[r]=ls(r,s,i)}})}stores(t){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?Z(this._cfg.storesSource,t):t;const r=n._versions,i={};let s={};return r.forEach(o=>{Z(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),n._dbSchema=s,Sr(n,[n._allTables,n,n.Transaction.prototype]),vn(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],$(s),s),n._storeNames=$(s),this}upgrade(t){return this._cfg.contentUpgrade=tr(this._cfg.contentUpgrade||T,t),this}}function Ar(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ye(fn,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Rr(e){return e&&typeof e.databases=="function"}function Cr(e){return Re(function(){return U.letThrough=!0,e()})}function Ga(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function Ya(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?V(t.dbOpenError):e);de&&(t.openCanceller._stackHolder=qe()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new x.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,l=!1;const a=()=>new L((u,c)=>{if(i(),!n)throw new x.MissingAPI;const p=e.name,d=t.autoSchema?n.open(p):n.open(p,Math.round(10*e.verno));if(!d)throw new x.MissingAPI;d.onerror=pe(c),d.onblocked=N(e._fireOnBlocked),d.onupgradeneeded=N(h=>{if(o=d.transaction,t.autoSchema&&!e._options.allowEmptyDB){d.onerror=Ot,o.abort(),d.result.close();const m=n.deleteDatabase(p);m.onsuccess=m.onerror=N(()=>{c(new x.NoSuchDatabase(`Database ${p} doesnt exist`))})}else{o.onerror=pe(c);var g=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;l=g<1,e._novip.idbdb=d.result,Wa(e,g/10,o,c)}},c),d.onsuccess=N(()=>{o=null;const h=e._novip.idbdb=d.result,g=Xt(h.objectStoreNames);if(g.length>0)try{const v=h.transaction((m=g).length===1?m[0]:m,"readonly");t.autoSchema?function({_novip:y},f,b){y.verno=f.version/10;const k=y._dbSchema=Ur(0,f,b);y._storeNames=Xt(f.objectStoreNames,0),vn(y,[y._allTables],$(k),k)}(e,h,v):(xr(e,e._dbSchema,v),function(y,f){const b=us(Ur(0,y.idbdb,f),y._dbSchema);return!(b.add.length||b.change.some(k=>k.add.length||k.change.length))}(e,v)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),kr(e,v)}catch{}var m;Ct.push(e),h.onversionchange=N(v=>{t.vcFired=!0,e.on("versionchange").fire(v)}),h.onclose=N(v=>{e.on("close").fire(v)}),l&&function({indexedDB:v,IDBKeyRange:y},f){!Rr(v)&&f!==fn&&Ar(v,y).put({name:f}).catch(T)}(e._deps,p),u()},c)}).catch(u=>u&&u.name==="UnknownError"&&t.PR1398_maxLoop>0?(t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),a()):L.reject(u));return L.race([r,(typeof navigator>"u"?L.resolve():Ga()).then(a)]).then(()=>(i(),t.onReadyBeingFired=[],L.resolve(Cr(()=>e.on.ready.fire(e.vip))).then(function u(){if(t.onReadyBeingFired.length>0){let c=t.onReadyBeingFired.reduce(tr,T);return t.onReadyBeingFired=[],L.resolve(Cr(()=>c(e.vip))).then(u)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(u=>{t.dbOpenError=u;try{o&&o.abort()}catch{}return r===t.openCanceller&&e._close(),V(u)}).finally(()=>{t.openComplete=!0,s()})}function Pr(e){var t=s=>e.next(s),n=i(t),r=i(s=>e.throw(s));function i(s){return o=>{var l=s(o),a=l.value;return l.done?a:a&&typeof a.then=="function"?a.then(n,r):J(a)?Promise.all(a).then(n,r):n(a)}}return i(t)()}function Ja(e,t,n){var r=arguments.length;if(r<2)throw new x.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,Pi(i),n]}function ds(e,t,n,r,i){return L.resolve().then(()=>{const s=U.transless||U,o=e._createTransaction(t,n,e._dbSchema,r),l={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(p){return p.name===er.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>ds(e,t,n,null,i))):V(p)}const a=Qn(i);let u;a&&at();const c=L.follow(()=>{if(u=i.call(o,o),u)if(a){var p=ve.bind(null,null);u.then(p,p)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=Pr(u))},l);return(u&&typeof u.then=="function"?L.resolve(u).then(p=>o.active?p:V(new x.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(p=>(r&&o._resolve(),o._completion.then(()=>p))).catch(p=>(o._reject(p),V(p)))})}function bn(e,t,n){const r=J(e)?e.slice():[e];for(let i=0;i<n;++i)r.push(t);return r}const Qa={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},s=[];function o(c,p,d){const h=Bt(c),g=i[h]=i[h]||[],m=c==null?0:typeof c=="string"?1:c.length,v=p>0,y={...d,isVirtual:v,keyTail:p,keyLength:m,extractKey:Er(c),unique:!v&&d.unique};return g.push(y),y.isPrimaryKey||s.push(y),m>1&&o(m===2?c[0]:c.slice(0,m-1),p+1,d),g.sort((f,b)=>f.keyTail-b.keyTail),y}const l=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[l];for(const c of r.indexes)o(c.keyPath,0,c);function a(c){const p=c.query.index;return p.isVirtual?{...c,query:{index:p,range:(d=c.query.range,h=p.keyTail,{type:d.type===1?2:d.type,lower:bn(d.lower,d.lowerOpen?e.MAX_KEY:e.MIN_KEY,h),lowerOpen:!0,upper:bn(d.upper,d.upperOpen?e.MIN_KEY:e.MAX_KEY,h),upperOpen:!0})}}:c;var d,h}return{...n,schema:{...r,primaryKey:l,indexes:s,getIndexByKeyPath:function(c){const p=i[Bt(c)];return p&&p[0]}},count:c=>n.count(a(c)),query:c=>n.query(a(c)),openCursor(c){const{keyTail:p,isVirtual:d,keyLength:h}=c.query.index;return d?n.openCursor(a(c)).then(g=>g&&function(m){return Object.create(m,{continue:{value:function(y){y!=null?m.continue(bn(y,c.reverse?e.MAX_KEY:e.MIN_KEY,p)):c.unique?m.continue(m.key.slice(0,h).concat(c.reverse?e.MIN_KEY:e.MAX_KEY,p)):m.continue()}},continuePrimaryKey:{value(y,f){m.continuePrimaryKey(bn(y,e.MAX_KEY,p),f)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const y=m.key;return h===1?y[0]:y.slice(0,h)}},value:{get:()=>m.value}})}(g)):n.openCursor(c)}}}}}};function Dr(e,t,n,r){return n=n||{},r=r||"",$(e).forEach(i=>{if(re(t,i)){var s=e[i],o=t[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){const l=Yn(s);l!==Yn(o)?n[r+i]=t[i]:l==="Object"?Dr(s,o,n,r+i+"."):s!==o&&(n[r+i]=t[i])}else s!==o&&(n[r+i]=t[i])}else n[r+i]=void 0}),$(t).forEach(i=>{re(e,i)||(n[r+i]=t[i])}),n}const Xa={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema;return{...n,mutate(s){const o=U.trans,{deleting:l,creating:a,updating:u}=o.table(t).hook;switch(s.type){case"add":if(a.fire===T)break;return o._promise("readwrite",()=>c(s),!0);case"put":if(a.fire===T&&u.fire===T)break;return o._promise("readwrite",()=>c(s),!0);case"delete":if(l.fire===T)break;return o._promise("readwrite",()=>c(s),!0);case"deleteRange":if(l.fire===T)break;return o._promise("readwrite",()=>function(d){return p(d.trans,d.range,1e4)}(s),!0)}return n.mutate(s);function c(d){const h=U.trans,g=d.keys||function(m,v){return v.type==="delete"?v.keys:v.keys||v.values.map(m.extractKey)}(r,d);if(!g)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:g}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(m,v,y){return v.type==="add"?Promise.resolve([]):m.getMany({trans:v.trans,keys:y,cache:"immutable"})}(n,d,g).then(m=>{const v=g.map((y,f)=>{const b=m[f],k={onerror:null,onsuccess:null};if(d.type==="delete")l.fire.call(k,y,b,h);else if(d.type==="add"||b===void 0){const E=a.fire.call(k,y,d.values[f],h);y==null&&E!=null&&(y=E,d.keys[f]=y,r.outbound||oe(d.values[f],r.keyPath,y))}else{const E=Dr(b,d.values[f]),_=u.fire.call(k,E,y,b,h);if(_){const w=d.values[f];Object.keys(_).forEach(A=>{re(w,A)?w[A]=_[A]:oe(w,A,_[A])})}}return k});return n.mutate(d).then(({failures:y,results:f,numFailures:b,lastResult:k})=>{for(let E=0;E<g.length;++E){const _=f?f[E]:g[E],w=v[E];_==null?w.onerror&&w.onerror(y[E]):w.onsuccess&&w.onsuccess(d.type==="put"&&m[E]?d.values[E]:_)}return{failures:y,results:f,numFailures:b,lastResult:k}}).catch(y=>(v.forEach(f=>f.onerror&&f.onerror(y)),Promise.reject(y)))})}function p(d,h,g){return n.query({trans:d,values:!1,query:{index:r,range:h},limit:g}).then(({result:m})=>c({type:"delete",keys:m,trans:d}).then(v=>v.numFailures>0?Promise.reject(v.failures[0]):m.length<g?{failures:[],numFailures:0,lastResult:void 0}:p(d,{...h,lower:m[m.length-1],lowerOpen:!0},g)))}}}}})};function ps(e,t,n){try{if(!t||t.keys.length<e.length)return null;const r=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)ee(t.keys[i],e[s])===0&&(r.push(n?kt(t.values[i]):t.values[i]),++s);return r.length===e.length?r:null}catch{return null}}const Za={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const i=ps(r.keys,r.trans._cache,r.cache==="clone");return i?L.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?kt(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Or(e){return!("from"in e)}const _e=function(e,t){if(!this){const n=new _e;return e&&"d"in e&&Z(n,e),n}Z(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Nt(e,t,n){const r=ee(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Or(e))return Z(e,{from:t,to:n,d:1});const i=e.l,s=e.r;if(ee(n,e.from)<0)return i?Nt(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},hs(e);if(ee(t,e.to)>0)return s?Nt(s,t,n):e.r={from:t,to:n,d:1,l:null,r:null},hs(e);ee(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),ee(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&_n(e,i),s&&o&&_n(e,s)}function _n(e,t){Or(t)||function n(r,{from:i,to:s,l:o,r:l}){Nt(r,i,s),o&&n(r,o),l&&n(r,l)}(e,t)}function el(e,t){const n=Tr(t);let r=n.next();if(r.done)return!1;let i=r.value;const s=Tr(e);let o=s.next(i.from),l=o.value;for(;!r.done&&!o.done;){if(ee(l.from,i.to)<=0&&ee(l.to,i.from)>=0)return!0;ee(i.from,l.from)<0?i=(r=n.next(l.from)).value:l=(o=s.next(i.from)).value}return!1}function Tr(e){let t=Or(e)?null:{s:0,n:e};return{next(n){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&ee(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||ee(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function hs(e){var t,n;const r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const s=i==="r"?"l":"r",o={...e},l=e[i];e.from=l.from,e.to=l.to,e[i]=l[i],o[i]=l[s],e[s]=o,o.d=fs(o)}e.d=fs(e)}function fs({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}nt(_e.prototype,{add(e){return _n(this,e),this},addKey(e){return Nt(this,e,e),this},addKeys(e){return e.forEach(t=>Nt(this,t,t)),this},[Jn](){return Tr(this)}});const tl={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new _e(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const i=e.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:l,outbound:a}=o,u={...i,mutate:d=>{const h=d.trans,g=h.mutatedParts||(h.mutatedParts={}),m=_=>{const w=`idb://${t}/${r}/${_}`;return g[w]||(g[w]=new _e)},v=m(""),y=m(":dels"),{type:f}=d;let[b,k]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const E=d.trans._cache;return i.mutate(d).then(_=>{if(J(b)){f!=="delete"&&(b=_.results),v.addKeys(b);const w=ps(b,E);w||f==="add"||y.addKeys(b),(w||k)&&function(A,S,F,D){function z(H){const M=A(H.name||"");function Se(G){return G!=null?H.extractKey(G):null}const he=G=>H.multiEntry&&J(G)?G.forEach(fe=>M.addKey(fe)):M.addKey(G);(F||D).forEach((G,fe)=>{const Be=F&&Se(F[fe]),pt=D&&Se(D[fe]);ee(Be,pt)!==0&&(Be!=null&&he(Be),pt!=null&&he(pt))})}S.indexes.forEach(z)}(m,s,w,k)}else if(b){const w={from:b.lower,to:b.upper};y.add(w),v.add(w)}else v.add(n),y.add(n),s.indexes.forEach(w=>m(w.name).add(n));return _})}},c=({query:{index:d,range:h}})=>{var g,m;return[d,new _e((g=h.lower)!==null&&g!==void 0?g:e.MIN_KEY,(m=h.upper)!==null&&m!==void 0?m:e.MAX_KEY)]},p={get:d=>[o,new _e(d.key)],getMany:d=>[o,new _e().addKeys(d.keys)],count:c,query:c,openCursor:c};return $(p).forEach(d=>{u[d]=function(h){const{subscr:g}=U;if(g){const m=k=>{const E=`idb://${t}/${r}/${k}`;return g[E]||(g[E]=new _e)},v=m(""),y=m(":dels"),[f,b]=p[d](h);if(m(f.name||"").add(b),!f.isPrimaryKey){if(d!=="count"){const k=d==="query"&&a&&h.values&&i.query({...h,values:!1});return i[d].apply(this,arguments).then(E=>{if(d==="query"){if(a&&h.values)return k.then(({result:w})=>(v.addKeys(w),E));const _=h.values?E.result.map(l):E.result;h.values?v.addKeys(_):y.addKeys(_)}else if(d==="openCursor"){const _=E,w=h.values;return _&&Object.create(_,{key:{get:()=>(y.addKey(_.primaryKey),_.key)},primaryKey:{get(){const A=_.primaryKey;return y.addKey(A),A}},value:{get:()=>(w&&v.addKey(_.primaryKey),_.value)}})}return E})}y.add(n)}}return i[d].apply(this,arguments)}}),u}}}};class Ye{constructor(t,n){this._middlewares={},this.verno=0;const r=Ye.dependencies;this._options=n={addons:Ye.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:T,dbReadyPromise:null,cancelOpen:T,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new L(l=>{s.dbReadyResolve=l}),s.openCanceller=new L((l,a)=>{s.cancelOpen=a}),this._state=s,this.name=t,this.on=Pt(this,"populate","blocked","versionchange","close",{ready:[tr,T]}),this.on.ready.subscribe=xi(this.on.ready.subscribe,l=>(a,u)=>{Ye.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||L.resolve().then(a),u&&l(a);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(a),u&&l(a);else{l(a);const p=this;u||l(function d(){p.on.ready.unsubscribe(a),p.on.ready.unsubscribe(d)})}})}),this.Collection=(o=this,Dt(Na.prototype,function(l,a){this.db=o;let u=es,c=null;if(a)try{u=a()}catch(g){c=g}const p=l._ctx,d=p.table,h=d.hook.reading.fire;this._ctx={table:d,index:p.index,isPrimKey:!p.index||d.schema.primKey.keyPath&&p.index===d.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:p.or,valueMapper:h!==Lt?h:null}})),this.Table=function(l){return Dt(Ba.prototype,function(a,u,c){this.db=l,this._tx=c,this.name=a,this.schema=u,this.hook=l._allTables[a]?l._allTables[a].hook:Pt(null,{creating:[La,T],reading:[Sa,Lt],updating:[Ua,T],deleting:[Ia,T]})})}(this),this.Transaction=function(l){return Dt($a.prototype,function(a,u,c,p,d){this.db=l,this.mode=a,this.storeNames=u,this.schema=c,this.chromeTransactionDurability=p,this.idbtrans=null,this.on=Pt(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new L((h,g)=>{this._resolve=h,this._reject=g}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},h=>{var g=this.active;return this.active=!1,this.on.error.fire(h),this.parent?this.parent._reject(h):g&&this.idbtrans&&this.idbtrans.abort(),V(h)})})}(this),this.Version=function(l){return Dt(za.prototype,function(a){this.db=l,this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(l){return Dt(os.prototype,function(a,u,c){this.db=l,this._ctx={table:a,index:u===":id"?null:u,or:c};const p=l._deps.indexedDB;if(!p)throw new x.MissingAPI;this._cmp=this._ascending=p.cmp.bind(p),this._descending=(d,h)=>p.cmp(h,d),this._max=(d,h)=>p.cmp(d,h)>0?d:h,this._min=(d,h)=>p.cmp(d,h)<0?d:h,this._IDBKeyRange=l._deps.IDBKeyRange})}(this),this.on("versionchange",l=>{l.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",l=>{!l.newVersion||l.newVersion<l.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${l.oldVersion/10}`)}),this._maxKey=Mt(n.IDBKeyRange),this._createTransaction=(l,a,u,c)=>new this.Transaction(l,a,u,this._options.chromeTransactionDurability,c),this._fireOnBlocked=l=>{this.on("blocked").fire(l),Ct.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(l))},this.use(Qa),this.use(Xa),this.use(tl),this.use(Za),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(l=>l(this))}version(t){if(isNaN(t)||t<.1)throw new x.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new x.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const n=this._versions;var r=n.filter(i=>i._cfg.version===t)[0];return r||(r=new this.Version(t),n.push(r),n.sort(Ha),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(t){return this.idbdb&&(this._state.openComplete||U.letThrough||this._vip)?t():new L((n,r)=>{if(this._state.openComplete)return r(new x.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new x.DatabaseClosed);this.open().catch(T)}this._state.dbReadyPromise.then(n,r)}).then(t)}use({stack:t,create:n,level:r,name:i}){i&&this.unuse({stack:t,name:i});const s=this._middlewares[t]||(this._middlewares[t]=[]);return s.push({stack:t,create:n,level:r??10,name:i}),s.sort((o,l)=>o.level-l.level),this}unuse({stack:t,name:n,create:r}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(i=>r?i.create!==r:!!n&&i.name!==n)),this}open(){return Ya(this)}_close(){const t=this._state,n=Ct.indexOf(this);if(n>=0&&Ct.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new L(r=>{t.dbReadyResolve=r}),t.openCanceller=new L((r,i)=>{t.cancelOpen=i})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new x.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,n=this._state;return new L((r,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=N(()=>{(function({indexedDB:l,IDBKeyRange:a},u){!Rr(l)&&u!==fn&&Ar(l,a).delete(u).catch(T)})(this._deps,this.name),r()}),o.onerror=pe(i),o.onblocked=this._fireOnBlocked};if(t)throw new x.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return $(this._allTables).map(t=>this._allTables[t])}transaction(){const t=Ja.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,n,r){let i=U.trans;i&&i.db===this&&t.indexOf("!")===-1||(i=null);const s=t.indexOf("?")!==-1;let o,l;t=t.replace("!","").replace("?","");try{if(l=n.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),t=="r"||t===yr)o=yr;else{if(t!="rw"&&t!=gr)throw new x.InvalidArgument("Invalid transaction mode: "+t);o=gr}if(i){if(i.mode===yr&&o===gr){if(!s)throw new x.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&l.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1){if(!s)throw new x.SubTransaction("Table "+u+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,p)=>{p(u)}):V(u)}const a=ds.bind(null,this,o,l,i,r);return i?i._promise(o,a,"lock"):U.trans?lt(U.transless,()=>this._whenReady(a)):this._whenReady(a)}table(t){if(!re(this._allTables,t))throw new x.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const nl=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class rl{constructor(t){this._subscribe=t}subscribe(t,n,r){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:n,complete:r})}[nl](){return this}}function ms(e,t){return $(t).forEach(n=>{_n(e[n]||(e[n]=new _e),t[n])}),e}function il(e){let t,n=!1;const r=new rl(i=>{const s=Qn(e);let o=!1,l={},a={};const u={get closed(){return o},unsubscribe:()=>{o=!0,Oe.storagemutated.unsubscribe(h)}};i.start&&i.start(u);let c=!1,p=!1;function d(){return $(a).some(m=>l[m]&&el(l[m],a[m]))}const h=m=>{ms(l,m),d()&&g()},g=()=>{if(c||o)return;l={};const m={},v=function(y){s&&at();const f=()=>Re(e,{subscr:y,trans:null}),b=U.trans?lt(U.transless,f):f();return s&&b.then(ve,ve),b}(m);p||(Oe(Tt,h),p=!0),c=!0,Promise.resolve(v).then(y=>{n=!0,t=y,c=!1,o||(d()?g():(l={},a=m,i.next&&i.next(y)))},y=>{c=!1,n=!1,i.error&&i.error(y),u.unsubscribe()})};return g(),u});return r.hasValue=()=>n,r.getValue=()=>t,r}let Mr;try{Mr={indexedDB:B.indexedDB||B.mozIndexedDB||B.webkitIndexedDB||B.msIndexedDB,IDBKeyRange:B.IDBKeyRange||B.webkitIDBKeyRange}}catch{Mr={indexedDB:null,IDBKeyRange:null}}const Je=Ye;function En(e){let t=Ee;try{Ee=!0,Oe.storagemutated.fire(e)}finally{Ee=t}}nt(Je,{...en,delete:e=>new Je(e,{addons:[]}).delete(),exists:e=>new Je(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function({indexedDB:t,IDBKeyRange:n}){return Rr(t)?Promise.resolve(t.databases()).then(r=>r.map(i=>i.name).filter(i=>i!==fn)):Ar(t,n).toCollection().primaryKeys()}(Je.dependencies).then(e)}catch{return V(new x.MissingAPI)}},defineClass:()=>function(e){Z(this,e)},ignoreTransaction:e=>U.trans?lt(U.transless,e):e(),vip:Cr,async:function(e){return function(){try{var t=Pr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:L.resolve(t)}catch(n){return V(n)}}},spawn:function(e,t,n){try{var r=Pr(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:L.resolve(r)}catch(i){return V(i)}},currentTransaction:{get:()=>U.trans||null},waitFor:function(e,t){const n=L.resolve(typeof e=="function"?Je.ignoreTransaction(e):e).timeout(t||6e4);return U.trans?U.trans.waitFor(n):n},Promise:L,debug:{get:()=>de,set:e=>{Oi(e,e==="dexie"?()=>!0:Zi)}},derive:rt,extend:Z,props:nt,override:xi,Events:Pt,on:Oe,liveQuery:il,extendObservabilitySet:ms,getByKeyPath:ge,setByKeyPath:oe,delByKeyPath:function(e,t){typeof t=="string"?oe(e,t,void 0):"length"in t&&[].map.call(t,function(n){oe(e,n,void 0)})},shallowClone:Ci,deepClone:kt,getObjectDiff:Dr,cmp:ee,asap:Ai,minKey:mr,addons:[],connections:Ct,errnames:er,dependencies:Mr,semVer:Qi,version:Qi.split(".").map(e=>parseInt(e)).reduce((e,t,n)=>e+t/Math.pow(10,2*n))}),Je.maxKey=Mt(Je.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Oe(Tt,e=>{if(!Ee){let t;hn?(t=document.createEvent("CustomEvent"),t.initCustomEvent(De,!0,!0,e)):t=new CustomEvent(De,{detail:e}),Ee=!0,dispatchEvent(t),Ee=!1}}),addEventListener(De,({detail:e})=>{Ee||En(e)}));let Ee=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel(De);typeof e.unref=="function"&&e.unref(),Oe(Tt,t=>{Ee||e.postMessage(t)}),e.onmessage=t=>{t.data&&En(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Oe(Tt,t=>{try{Ee||(typeof localStorage<"u"&&localStorage.setItem(De,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:De,changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key===De){const n=JSON.parse(t.newValue);n&&En(n.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function({data:t}){t&&t.type===De&&En(t.changedParts)})}L.rejectionMapper=function(e,t){if(!e||e instanceof st||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ni[e.name])return e;var n=new Ni[e.name](t||e.message,e);return"stack"in e&&ye(n,"stack",{get:function(){return this.inner.stack}}),n},Oi(de,Zi);const ys=async(e,t)=>{const n=performance.now();try{await e()}finally{const r=performance.now()-n;let i=wt[t];i||(i=Jt(t)),i.report(r/1e3)}},gs=(e,t)=>{const n=performance.now();try{e()}finally{const r=performance.now()-n;let i=wt[t];i||(i=Jt(t)),i.report(r/1e3)}},sl=30,ol=3e4;let Ft=0;const ws=()=>{Y.setItem("sprig.disableReplayRecording","disabled")},Qe=()=>!!Y.getItem("sprig.disableReplayRecording"),al=["did not allow mutations","called in an invalid security context"],ll=e=>{if(!e)return!0;for(const t of al)if(e.toLowerCase().includes(t))return!1;return!0},cl=(e,t,{reportError:n=!0,extraInfo:r})=>{Qe()||t instanceof Error&&(ws(),ll(t==null?void 0:t.message)&&(n&&window.UserLeap.reportError(e,t,r),dl()))},ul=async(e,t,{reportError:n}={reportError:!0})=>{var i;let r;try{if(n&&((i=window.navigator.storage)!=null&&i.estimate)){const{quota:s,usage:o}=await window.navigator.storage.estimate();r={availableSpaceInMB:s&&o?(s-o)/(1024*1024):void 0,quota:s,usage:o}}}catch(s){window.UserLeap.reportError("Error getting storage estimate",s,{originalMessage:e,originalError:t})}cl(e,t,{reportError:n,extraInfo:r})},X=(()=>{const e=Y.getItem("sprig.sessionId");if(e)return I(`Found saved session id: ${e}`),Y.removeItem("sprig.sessionId"),e;const t=Fe();return I(`Generating new uuid: ${t}`),t})();window.addEventListener("beforeunload",()=>{I(`Before page unload saving session id: ${X}`),Y.setItem("sprig.sessionId",X)});const dl=async()=>{P.transaction("rw",P.events,P.chunkUploads,P.pendingCaptures,()=>{P.events.clear(),P.chunkUploads.clear(),P.pendingCaptures.clear()}).catch(()=>{})},Br=(e,t,n=()=>!0)=>P.table(t).where("timestamp").below(e).and(n).delete(),pl=async(e,t)=>{let n=[];return await ys(async()=>{n=await P.events.where("[sessionId+timestamp]").between([X,e],[X,t??Date.now()]).toArray()},"sdk_replay_get_events_between_seconds"),n},hl=(e,t,n)=>{const r=new Date,i=r.setMinutes(r.getMinutes()+(n??sl));return P.events.where("[sessionId+timestamp]").between([X,e],[X,t]).modify({expiredAt:i})},fl=e=>P.chunkUploads.add({...e,sessionId:e.sessionId??X}),ml=(e,t)=>P.chunkUploads.update(e,{data:null,etag:t,status:"UploadComplete"}),yl=({status:e,uploadId:t})=>t?P.chunkUploads.where({uploadId:t,status:e}).toArray():P.chunkUploads.where({sessionId:X,status:e}).toArray(),gl=e=>P.chunkUploads.where({uploadId:e,status:"UploadComplete"}).toArray(),wl=e=>P.chunkUploads.where({uploadId:e,status:"UploadComplete"}).delete(),vl=e=>P.pendingCaptures.add({...e,sessionId:e.sessionId??X,canUpload:!1}),vs=async e=>{let t=await P.pendingCaptures.where("sessionId").equals(X).toArray();return e.beforePresent&&(t=t.filter(n=>n.targetTimestamp<Date.now())),e.isHeatmap&&(t=t.filter(n=>n.captureParams.isHeatmap??!1)),t},bl=()=>P.pendingCaptures.where("sessionId").equals(X).toArray(),_l=e=>P.pendingCaptures.where("sessionId").equals(X).and(t=>t.captureParams.responseGroupId===e).modify({canUpload:!0}),El=async e=>{var t;if((t=window.navigator.storage)!=null&&t.estimate){const{quota:n,usage:r}=await window.navigator.storage.estimate();if(n&&r&&(n-r)/1073741824<e)return!1}return!0},bs=async e=>{if(parseInt(Y.getItem("sprig.pendingCount")??"0")===0)return;const n=Date.now();return ke(async()=>{await P.pendingCaptures.where("sessionId").equals(X).and(r=>r.captureParams.isHeatmap??!1).and(r=>e?e.includes(r.uuid):!0).modify(r=>{r.targetTimestamp=n,r.captureParams.triggerTimestamp=n,r.captureParams.replayParams.replayDurationSeconds=Math.floor((n-r.timestamp)/1e3)})},"Error marking pending heatmaps ready")},kl=async()=>{const t=(await vs({isHeatmap:!0})).map(r=>({eventId:r.captureParams.eventId,uuid:r.uuid})),n=[];t.forEach(({eventId:r,uuid:i})=>{ui(r)||n.push(i)}),n.length&&bs(n)},Sl=e=>{if(e>1){Ft=0;return}const t=Date.now();if(!Ft){Ft=t;return}t-Ft>=ol&&(bs(),Ft=0)};class Ll extends Ye{constructor(){super("replayStorage",{autoOpen:!1});q(this,"events");q(this,"chunkUploads");q(this,"pendingCaptures")}}const P=new Ll;P.version(1).stores({events:"uuid, timestamp, [sessionId+timestamp]",chunkUploads:"uuid, timestamp, [sessionId+status], [uploadId+status], [sessionId+status+uploadId]",pendingCaptures:"uuid, timestamp, [sessionId+targetTimestamp]"}),P.open().catch(e=>{ri(`Error opening replay storage: ${JSON.stringify(e)}`),ws()});const Il=e=>{if(e instanceof Attr)return null;let t=1;for(let n=e.previousSibling;n;n=n.previousSibling)n.nodeName===e.nodeName&&++t;return t},_s=e=>{if(e===null)return"";const t=[];if(e instanceof Document)return"/";for(let n=e;n&&!(n instanceof Document)&&n!==null;n=n instanceof Attr?n.ownerElement:n.parentElement){const r=t[t.length]={name:void 0,position:null};switch(n.nodeType){case Node.TEXT_NODE:r.name="text()";break;case Node.ATTRIBUTE_NODE:r.name="@"+n.nodeName;break;case Node.PROCESSING_INSTRUCTION_NODE:r.name="processing-instruction()";break;case Node.COMMENT_NODE:r.name="comment()";break;case Node.ELEMENT_NODE:r.name=n.nodeName;break}r.position=Il(n)}return"/"+t.reverse().map(n=>n.position!==null?`/${n.name}[${n.position}]`:`/${n.name}`).join("")},Te={capture:!0,passive:!0},Ul=["a","button","input","option","li","link"],xl=["Escape","Enter","Backspace","F5","Tab"];let kn=!1;const Al=["label","type","role","title","placeholder","errormessage","valuetext","href"],Es="aria-",Rl=e=>{if(!e.tagName)return"No tagName";const t=e.getAttribute("type");return t?`${t} ${e.tagName.toLowerCase()}`:e.tagName.toLowerCase()},ks=e=>{var r;if(((r=e.tagName)==null?void 0:r.toLowerCase())==="html")return{element:"html"};const t=e.textContent,n=t?{text:t}:{};n.element=Rl(e);for(const i of e.attributes){let s=i.name;const o=i.value;s.startsWith(Es)&&(s=s.substring(Es.length)),Al.includes(s)&&(n[s]=o)}return n},Cl=e=>{var i;if(!e)return{};const n={...ks(e)},r=e.parentElement;if(r&&Ul.includes((i=r.tagName)==null?void 0:i.toLowerCase())){const s=ks(r);Object.assign(n,s)}return n},Ss=(e,t)=>{var n;Vs({x:t.x,y:t.y,type:e,elementAttributes:Cl(t.target),windowHeight:window.innerHeight,windowWidth:window.innerWidth,...t.target instanceof HTMLElement?{rect:(n=t.target)==null?void 0:n.getBoundingClientRect(),xPath:_s(t.target)}:{}})},Pl=e=>t=>Ss(e,t),Ls=e=>{xl.includes(e.key)&&zs({key:e.key})},Dl=()=>{window.performance.getEntriesByType("navigation").map(t=>t.type).includes("reload")&&Hs({url:window.location.href,currentPageTitle:document.title})},Ol=()=>{window.performance.getEntriesByType("navigation").map(t=>t.type).includes("back_forward")&&Ws({curUrl:window.location.href,fromUrl:document.referrer,currentPageTitle:document.title})},Is=((e,t)=>{let n;return r=>{clearTimeout(n),n=window.setTimeout(()=>e(r),t)}})(e=>{if(!(e.target instanceof HTMLElement||e.target instanceof Document))return;let t=e.target;"scrollTop"in t||(t=t.documentElement),Gs({xPath:_s(t),x:t.scrollLeft,y:t.scrollTop,elementAttributes:{targetScrollWidth:t.scrollWidth,targetClientWidth:t.clientWidth,targetScrollHeight:t.scrollHeight,targetClientHeight:t.clientHeight}})},750),Us=Pl("left_click"),xs=e=>{e.button===2&&Ss("right_click",e)},Tl=()=>{kn||(window.addEventListener("click",Us,Te),window.addEventListener("mousedown",xs,Te),window.addEventListener("keydown",Ls,Te),window.addEventListener("scroll",Is,Te),kn=!0,Dl(),Ol())},Ml=()=>{kn&&(window.removeEventListener("click",Us,Te),window.removeEventListener("mousedown",xs,Te),window.removeEventListener("keydown",Ls,Te),window.removeEventListener("scroll",Is,Te),kn=!1)},Bl=async(e,t,n)=>new Promise((r,i)=>{const s=e.createElement("script");s.src=t,s.onload=r,s.onerror=i,n&&(s.nonce=n),e.head.appendChild(s)});let As=1,Nr=5e3,Sn=6e4;const Nl=5,Rs=1e3,Cs=30,Ln=Cs+Nl;let Fr,jr,Ps,Ds=Date.now(),dt=!1,In;const Os={},Fl=async({viewDocument:e,maxReplayDurationSeconds:t,replayNonce:n,maxInflightRequests:r=2,replaySettings:i,teardownAfter:s=!1})=>{dt||(s&&Y.setItem("sprig.teardownAfterCapture","true"),await ke(async()=>{if(Qe()){I("Not initializing replay because recording is disabled");return}if(!t){I("Not initializing replay because config didn't specify maxReplayDurationSeconds");return}if(i!=null&&i.minAvailableGb&&(As=i.minAvailableGb),!await El(As)){Rn("Minimum storage not available");return}if(I("Initializing replay"),i!=null&&i.minDuration&&(Nr=i.minDuration),i!=null&&i.batchDuration&&(Sn=i.batchDuration),pa(r),Wl(),$l(t+Ln,30*60,t+Ln),ql(),!window.rrwebRecord){I("Loading recording script");const u=window.UserLeap.replayLibraryURL??"https://cdn.sprig.com/dependencies/record-2.0.0-alpha.6.min.js";await Bl(e,u,n),I("Recording script finished loading")}const o=window.rrwebRecord;if(!o){Rn("Record script failed to set global function");return}let l=!0,a=0;In=o({checkoutEveryNms:Cs*1e3,sampling:{input:"last",scroll:250,media:800},emit:(u,c)=>{if(Qe())return;if(Ds=Date.now(),c&&u.type===Qt.Meta)a=performance.now();else if(c&&a&&u.type===Qt.FullSnapshot){const d=performance.now()-a;bi("sdk_replay_snapshot_seconds",d/1e3)}const p=l||!!c&&u.type===Qt.Meta;l=!1,jl({uuid:Fe(),event:JSON.stringify(u),isValidStart:p,timestamp:Date.now()})},...i}),dt=!0,jr||(jr=window.setInterval(()=>{Date.now()-Ds>Rs&&ae("Sprig_Noop",{})},Rs)),C.on("survey.complete",u=>{qs({id:u,userAgent:window.navigator.userAgent})}),Tl()},"Error initializing replay"))};let Me=Y.getItem("sprig.pendingCount"),Kr=!!Y.getItem("sprig.isCapturingHeatmap"),$r=!1,qr=[];const jl=e=>{var t,n,r,i;if((t=e.event)!=null&&t.includes("Sprig_Scroll")){const s=(i=(r=(n=JSON.parse(e.event))==null?void 0:n.data)==null?void 0:r.payload)==null?void 0:i.xPath;if(!s)return;const o=Fe();Os[s]=o,e.uuid=o}qr.push(e),$r||Kl()},Ts=e=>{const t=e.map(n=>({...n,sessionId:n.sessionId??X}));if(Kr&&Sl(t.length),t.length!==0)return P.transaction("rw",P.events,()=>{P.events.bulkAdd(t)}).catch(n=>{Xe("Error storing replay events",n)})},Kl=()=>{$r=!0,setTimeout(async()=>{if(Qe())return;const e=qr;qr=[],$r=!1,gs(async()=>{await Ts(e)},"sdk_replay_add_event_batch_seconds")},500)},$l=(e=6*60,t=30*60,n=4*60)=>{Fr=window.setInterval(()=>{const r=Date.now();Qe()||(ht(`Performing periodic replay data cleanup / Event Seconds ${e} / Chunk Seconds ${t} / Pending Capture Seconds ${n}`),ys(()=>P.transaction("rw!",P.events,P.chunkUploads,P.pendingCaptures,()=>{Br(r-e*1e3,"events",i=>i.expiredAt===void 0||i.expiredAt<r-e*1e3),Br(r-t*1e3,"chunkUploads"),Br(r-n*1e3,"pendingCaptures",i=>i.canUpload===void 0||i.canUpload===!1)}).catch(i=>{clearInterval(Fr),Xe("Error deleting table rows",i)}),"sdk_replay_cleanup_seconds"),I("Cleanup complete"))},30*1e3)},ql=(e=5)=>{Ps=window.setInterval(async()=>{ke(async()=>{const t=parseInt(Me??"0");if(t===0)return;const n=await vs({beforePresent:!0});n!=null&&n.length&&(await Promise.all(n.map(async r=>(await P.pendingCaptures.delete(r.uuid),js(r.captureParams,r.canUpload)))),Me=(t-n.length).toString(),Y.setItem("sprig.pendingCount",Me))},"Error initiating pending captures")},e*1e3)},Vl=async(e,t,n,r,i)=>{const s=Math.min(e+i,n),o=`from: ${new Date(e).toLocaleTimeString()} to ${new Date(s).toLocaleTimeString()}`;I(`Getting event batch ${o}`);const l=await pl(e,s);if(!(l!=null&&l.length))return I(`No events found ${o}`),{validStartFound:r,events:[]};if(!r){I(`Searching for valid start in ${l.length} events ${o}`);let a=-1;if(l==null||l.forEach((c,p)=>{if(!c.isValidStart)return;const d=c.timestamp<=t;(a<0||d)&&(a=p)}),a<0)return I(`No valid start found in ${l.length} events ${o}`),{validStartFound:r,events:[]};const u=l[a].timestamp;return I(`Found valid start at: ${new Date(u).toLocaleTimeString()} in events ${o}`),{validStartFound:!0,events:l==null?void 0:l.slice(a)}}return{validStartFound:r,events:l}},Hl=(e,t,n)=>{const r=e.length,i=t*1024*1024,s=Math.ceil(r/n),o=Math.max(i,s);I(`Total file bytes: ${r} / target chunk size: ${o}`);const l=[];let a=0;for(;a<r;)l.push(e.slice(a,a+o)),a+=o;return l},Ms=e=>Promise.all(e.map(async t=>{const n=await ha(t);return await ml(t.uuid,n),t.uploadId})),Bs=async e=>{I(`Marking upload complete if finished: ${e}`);const t=await gl(e);if(!(t!=null&&t.length)){I(`No finished chunks found for upload: ${e}`);return}const n=t.reduce((s,o)=>(s.find(l=>l.chunkIndex===o.chunkIndex)||s.push(o),s),[]);n.sort((s,o)=>s.chunkIndex-o.chunkIndex);const r=n.map(s=>({ETag:s.etag,PartNumber:s.chunkIndex})).filter(s=>s.ETag!==null),i=n[0];await Ii({apiUrl:i.apiUrl,surveyId:i.surveyId,uploadId:e,responseGroupUuid:i.responseGroupId,etags:r,headers:i.completeUploadHeaders,replayDuration:i.replayDuration}),I(`Cleaning up chunks for ${e}`),await wl(e),I(`Done cleaning up chunks for ${e}`)},Wl=async()=>{ke(async()=>{const e=await yl({status:"ReadyForUpload"});if(!(e!=null&&e.length))return;const t=await Ms(e);I(`Finished uploading unfinished chunks for ${t}`),t!=null&&t.length&&await Promise.all(t.map(n=>{if(n)return Bs(n)}))},"Error uploading unfinished chunks")},zl=async(e,t)=>{await Ms(t),I(`Done uploading chunks for uploads: ${e.join(",")}`),await Promise.all(e.map(n=>Bs(n)))},Gl=e=>{let t=0;e.forEach(i=>{t+=i.length});const n=new Uint8Array(t);let r=0;return e.forEach(i=>{n.set(i,r),r+=i.length}),n},Ns=async(e,t,n)=>{const r=new TextEncoder;let i=null,s=null,o=null,l=!1,a=!1,[u,c]=[0,0];const p=e-Ln*1e3,d=[];let h=[];I(`Getting events between ${new Date(e).toLocaleTimeString()} and ${new Date(t).toLocaleTimeString()}`),I(`Using batch duration: ${Sn}ms`);for(let m=p;m<t;m+=Sn){if({validStartFound:a,events:h}=await Vl(m,e,t,a,Sn),!(h!=null&&h.length)){I("No events found");continue}u===0&&(u=h[0].timestamp),c=h[h.length-1].timestamp,I(`Last event time in batch: ${new Date(c).toLocaleTimeString()}`);const v=`${l?",":"["}${h.map(f=>f.event).join(",")}`,y=r.encode(v);n&&s===null&&(ht("Attempting compression"),o=new window.CompressionStream("gzip"),s=o.writable.getWriter()),gs(()=>{n&&s?s.write(y):d.push(y)},"sdk_replay_compression_seconds"),l=!0}if(c-u<Nr)return I(`Replay duration is shorter than minimum of ${Nr}ms / Start:${u} / End:${c}`),null;const g=r.encode("]");return ht("Writing final close brace"),s&&o?(s.write(g),s.close(),i=new Uint8Array(await new Response(o.readable).arrayBuffer())):(d.push(g),i=Gl(d)),I("Finished generating file data"),i},Yl=async(e,t)=>{const n=window.CompressionStream!==void 0;let r=null;const i=t??Date.now(),s=i-e;try{r=await Ns(s,i,n)}catch(o){o instanceof Error&&window.UserLeap.reportError("Error compressing replay",o),n&&ke(async()=>{await Ns(s,i,!1)},"fileData fallback failed")}return r},Fs=async e=>{const{surveyId:t,responseGroupId:n,visitorId:r,apiUrl:i,completeUploadHeaders:s,replayParams:o,triggerTimestamp:l}=e,a=await Yl(o.replayDurationSeconds*1e3,l);if(a!=null&&a.length)I(`Found file data for survey: ${t}`);else{I(`File data is empty for survey: ${t}`);return}const u=Hl(a,o.minimumChunkSizeMb,o.signedUrls.length);I(`Got ${u.length} chunks for survey: ${t}`);const c=await Promise.all(u.map(async(p,d)=>{const h=Fe(),g={apiUrl:i,chunkIndex:d+1,completeUploadHeaders:s,etag:null,responseGroupId:n,status:"ReadyForUpload",surveyId:t,timestamp:l,totalChunks:u.length,data:p,uploadId:o.uploadId,uploadUrl:o.signedUrls[d].url,uuid:h,visitorId:r};return I(`Recording chunk upload: ${JSON.stringify({index:g.chunkIndex,surveyId:g.surveyId,uploadId:g.uploadId,size:p.length,id:h},null,2)}`),await fl(g),I(`Done creating chunk upload: ${h}`),g}));I(`All chunk records created. Beginning upload for survey: ${t}`),await zl([o.uploadId],c)},js=async(e,t)=>{if(I(`Attempting replay capture: ${JSON.stringify({isStandalone:e.isStandalone,duration:e.replayParams.replayDurationSeconds,type:e.replayParams.replayDurationType,responseGroupId:e.responseGroupId,surveyId:e.surveyId,triggerTimestamp:e.triggerTimestamp,visitorId:e.visitorId},null,2)}`),Qe()){I(`Replay recording is disabled: ${e.surveyId}`);return}I(`Replay recording enabled: ${e.surveyId}`);const{isHeatmap:n,isStandalone:r,replayParams:i,triggerTimestamp:s,responseGroupId:o}=e,l=async()=>{setTimeout(()=>C.removeListener(R.QuestionAnswered,l),0),ke(async()=>{i.replayDurationType==="before"?await Fs(e):await _l(o)},"Error in schedule/capture callback")};ke(async()=>{if(i.replayDurationType==="after"||i.replayDurationType==="beforeAndAfter"){!r&&!n&&(I("Attaching QuestionAnswered listener for non-standalone replay"),C.on(R.QuestionAnswered,l)),I(`Scheduling capture for replay of type: ${i.replayDurationType}`),await $s(e);return}if(r||n||t)I(`Proceeding to capture replay for survey: ${e.surveyId} / standalone? ${r} / canUpload? ${t}`),await Fs(e),n&&Jl();else{const u=Ln+i.replayDurationSeconds,c=s-u*1e3,p=s;I(`Setting expiry minutes to ${i.expirationTimeLimitMinutes} for events from ${new Date(c).toLocaleTimeString()} to ${new Date(p).toLocaleTimeString()}`),await hl(c,p,i.expirationTimeLimitMinutes),I("Attaching QuestionAnswered listener"),C.on(R.QuestionAnswered,l)}},"Error in scheduling/capturing replay")},Jl=async()=>{parseInt(Me??"0")||(Y.removeItem("sprig.isCapturingHeatmap"),Kr=!1),Y.getItem("sprig.teardownAfterCapture")&&(Vr(),Ks(),Y.removeItem("sprig.teardownAfterCapture"))},Ks=()=>{if(Qe()){ht("Not clearing user data, replay is disabled");return}return P.transaction("rw",P.events,P.pendingCaptures,()=>{P.events.where("sessionId").equals(X).delete(),P.pendingCaptures.where("sessionId").equals(X).delete()}).catch(e=>{Xe("Error clearing session event data",e)})},$s=async e=>{I(`Scheduling replay capture: ${JSON.stringify(e)}`);const{isHeatmap:t,surveyId:n}=e,r=await bl(),i=r==null?void 0:r.filter(l=>l.captureParams.surveyId===n);if(i!=null&&i.length){I(`Pending capture exists for survey: ${n}`);return}t&&(Xl(),Kr=!0,Y.setItem("sprig.isCapturingHeatmap","true"));const s={...e,replayParams:{...e.replayParams}};e.replayParams.replayDurationType==="beforeAndAfter"&&(s.replayParams.replayDurationSeconds*=2),s.replayParams.replayDurationType="before";const o=e.triggerTimestamp+e.replayParams.replayDurationSeconds*1e3;return s.triggerTimestamp=o,Me=Me?(parseInt(Me)+1).toString():"1",Y.setItem("sprig.pendingCount",Me),vl({uuid:Fe(),targetTimestamp:o,timestamp:Date.now(),captureParams:s})},ae=(e,t)=>{var n,r;if(dt)try{(r=(n=window.rrwebRecord)==null?void 0:n.addCustomEvent)==null||r.call(n,e,t)}catch(i){Xe("Error recording custom event",i)}},ke=async(e,t)=>{try{await e()}catch(n){Xe(t,n)}},Ql=e=>{e.description&&(e.description=Hr(e.description)),ae("Sprig_PageView",e)},Xl=()=>{var e,t;if(!(!dt||!window.rrwebRecord))try{(t=(e=window.rrwebRecord)==null?void 0:e.takeFullSnapshot)==null||t.call(e,!0)}catch(n){Xe("Error recording full snapshot",n)}},Zl=e=>{ae("Sprig_TrackEvent",e)},ec=e=>{ae("Sprig_ShowSurvey",e)},qs=e=>{ae("Sprig_SubmitSurvey",e)},Vs=e=>{var t;(t=e==null?void 0:e.elementAttributes)!=null&&t.text&&(e.elementAttributes.text=Hr(e.elementAttributes.text)),ae("Sprig_Click",e)},Hs=e=>{ae("Sprig_Refresh",e)},Ws=e=>{e.currentPageTitle&&(e.currentPageTitle=Hr(e.currentPageTitle)),ae("Sprig_BackForward",e)},zs=e=>{ae("Sprig_Keystroke",e)},Gs=async e=>{const{x:t,xPath:n,y:r}=e,i=Os[n];i?ke(async()=>{var o,l,a,u;const s=await P.events.get(i);if(s!=null&&s.event){const c=JSON.parse(s.event),p=t>((l=(o=c.data)==null?void 0:o.payload)==null?void 0:l.x)||0,d=r>((u=(a=c.data)==null?void 0:a.payload)==null?void 0:u.y)||0;if(!(p||d))return;p&&(c.data.payload.x=t),d&&(c.data.payload.y=r),c.data.payload.elementAttributes=e.elementAttributes,s.event=JSON.stringify(c),P.events.put(s)}else ae("Sprig_Scroll",e)},"Error updating scroll event"):ae("Sprig_Scroll",e)},Vr=()=>{In&&(In(),In=void 0),dt=!1,[Fr,jr,Ps].forEach(e=>{e&&clearInterval(e)}),Ml()},Xe=(e,t,{reportError:n}={reportError:!0})=>(Vr(),ri(`${e} - ${JSON.stringify(t)}`),ul(e,t,{reportError:n})),tc=()=>dt,Hr=e=>e&&e.trim().substring(0,500).replace(/\s\s+/g," ").replace(/\r?\n|\r/g," ").substring(0,250);io(Object.freeze(Object.defineProperty({__proto__:null,RecordBackForward:Ws,RecordClick:Vs,RecordEvent:Zl,RecordKeystroke:zs,RecordPageView:Ql,RecordRefresh:Hs,RecordScroll:Gs,RecordSurveyComplete:qs,RecordSurveyShown:ec,_completeSessionReplay:async({surveyId:e,responseGroupUuid:t,eventDigest:n,headers:r})=>{if(!e||!t)return!1;const i=window.UserLeap._API_URL;try{const s=await Ii({surveyId:e,responseGroupUuid:t,eventDigest:n,apiUrl:i,headers:r},!0);return!(s!=null&&s.error)}catch(s){return console.warn("[Sprig] Error with completing session replay"),s instanceof Error&&window.UserLeap.reportError("completeSessionReplay",s),!1}},batchStoreEvents:Ts,checkPendingHeatmapsUrl:kl,clearUserReplayData:Ks,disableRecording:Xe,initializeReplay:Fl,isReplayRecording:tc,scheduleCapture:$s,scheduleOrCaptureReplay:js,teardownReplay:Vr,tryReplayAction:ke},Symbol.toStringTag,{value:"Module"})));const nc="sprig-web-view-sdk";let Ys;Ys={path:`https://cdn.sprig.com/${nc}-v2.30.3.js`},ua(Ys)})();

//# debugId=d6c47ae0-82f3-59c7-887d-27eeb2a84d67
